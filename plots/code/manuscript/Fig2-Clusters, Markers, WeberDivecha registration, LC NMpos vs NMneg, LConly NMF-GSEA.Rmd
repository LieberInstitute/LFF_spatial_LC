---
title: "Fig2-Clusters, Markers, WeberDivecha registration, LC NMpos vs NMneg, LConly NMF-GSEA"
format: html
date: "09-05-2025"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.height = 10,fig.width = 7,include = FALSE)
#### sets tab autocompletion for directories to begin from the directory containing the .Rproj session, instead of the script's directory if different
knitr::opts_knit$set(root.dir = here::here())

library(data.table)
library(ggplot2)
library(ggtext)
library(gridExtra)
library(SpatialExperiment)
library(spatialLIBD)
library(ggrastr)
library(ComplexHeatmap)
library(Cairo) # pdf device for ^ to properly save; also used for complexheatmap raster functions
library(circlize) #colorRamp2
library(viridis) # magma
library(ggrepel) # volcano point labeling

## rstudio GUI tweaks
require(colorout)
ColorOut()
options('styler.addins_style_transformer' = 'biocthis::bioc_style()')
##

## enable forked parallel processing with BiocParallel::multicoreParam, future::, etc. seemed to need this a couple times, but otherwise havent so its here as a preventative measure. part of this is adding the line 
# OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES
# to Renviron.site. see e.g. top response on https://stackoverflow.com/questions/73638290/python-on-mac-is-it-safe-to-set-objc-disable-initialize-fork-safety-yes-globall 
library(parallelly)
options(parallelly.supportsMulticore.disableOn='')
options(parallelly.fork.enable=TRUE)
library(BiocParallel)
options(bphost='localhost')


## ggplot defaults
theme_set(theme_bw()+theme(axis.text.x = element_text(size = 9), axis.title.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.y = element_text(size =9), plot.title = element_markdown(size = 11,hjust=0.5), strip.text = element_text(size=11), legend.text = element_text(size=8), legend.title = element_text(size=9,hjust=0.5),plot.title.position='plot'))

## last of all, unload the base package datasets, whose data keep getting in the way of autocompletions (e.g., Theoph is priortized over TRUE)
unloadNamespace('datasets')
```

## For the clustering spotplots, we want to use the H&E images plotted by single tissue section, so use the Samui RDS
```{r}
lc2 <- readRDS("processed-data/14_Samui_prep/01-Samui_TissSect_SPE_RotsMirrors.RDS")

# this spe doesn't have the plot-ready versions of domain names so import
louvs <- readRDS("processed-data/07_featureSelection_dimred_harmony_clustering/04-Initial_louvLeid_res0.5-1-2_clusterings.RDS")
louvs <- louvs$HARMONYlmbna_HDG_SVG_2575[,.(rn,snnHARMONYlmbna_HDG_SVG_2575_louv_res1)]
setnames(louvs,2,"clusid")

anno <- fread("processed-data/08_validitycheck_25hdg75svg_louv1/10-25hdg75svg_louv1_annots.txt")
louvs <- merge.data.table(louvs,anno,by="clusid")

## LC NM+- sublabels are already in the SPE for later.

louvs <- DataFrame(louvs,row.names=louvs$rn)[colnames(lc2),]
stopifnot(nrow(louvs)==ncol(lc2))

colLabels(lc2) <- louvs$plot_anno

rm(louvs,anno)
gc(full=T)
```

## load cluster 9-color palette
```{r}
pal <- readRDS("plots/finalpal_somuchfornorainbows.RDS")

stopifnot(all(names(pal) %in% unique(lc2$label)))
```

### custom function to extrct legend from one plot to extend to all ###
```{r}
extract_legend <- function(my_ggp) {
    step1 <- ggplot_gtable(ggplot_build(my_ggp))
    step2 <- which(sapply(step1$grobs, function(x) x$name) == "guide-box")
    step3 <- step1$grobs[[step2]]
    return(step3)
}
```

## Fig 2A: 2x2 grid of plots with the clusters indicated
show ONE section for ea of the following captures: V13M06-331_A1, V13M06-333_B1, V13M06-404_B1, V13M06-403_D1. But first make a shared legend to extract
```{r}
tmpdat <- as.data.table(colData(lc2[,lc2$sample_id=="V13M06-331_A1s1"])[,c("label","array_row","array_col")])

tmpplt <- ggplot(tmpdat,aes(x=array_col,y=array_row,col=label))+
    geom_point()+
    scale_color_manual(values = pal)+
    theme(legend.key.height = unit(0.083,"in"),
          legend.key.width = unit(0.156,"in"),
          legend.text=element_markdown(size=7,margin=margin(0,0,0,-0.025,unit="in")),
          legend.title=element_blank(),
          legend.key=element_blank(),
          legend.background = element_blank())

leg.tmp <- extract_legend(tmpplt)
dev.off()
####

samps <- c("V13M06-331_A1s1","V13M06-333_B1s2","V13M06-404_B1s2","V13M06-403_D1s1")

tmpcd <- unique(as.data.table(colData(lc2))[,.(sample_id,capture_id,Sex,APOE,YRI)])
# uh somehow donor id isn't in here but we can nab that rq
demos <- fread("raw-data/demos.txt")
demos[,capture_id:=paste0(slide,"_",array)]
tmpcd <- merge.data.table(tmpcd,demos[,.(capture_id,Donors)])
rm(demos)

plts <- lapply(samps,function(s){
  subcd <- tmpcd[sample_id==s]
  ttl <- paste0(subcd$Donors,
                " (",
                gsub(subcd$APOE,pattern=" ",replacement=""),
                ", ",
                ifelse(subcd$YRI>0.5,"AA","EA"),
                ", ",
                subcd$Sex,
                ")"
                )
  p <- vis_clus(lc2,sampleid=s,spatial = T,na_color = NA,auto_crop = T,point_size = 0.6,alpha=0.65,clustervar = "label",colors = pal,image_id = "lowres")+
        guides(color="none",fill="none")+
        ggtitle(ttl)+
        theme(plot.title = element_text(size=9,hjust=0.5,margin=margin(0,0,0,0,unit="in")),
              panel.border = element_blank(),
              plot.margin = margin(-0.1,0.025,-0.475,-0.45,unit="in"))
    p <- rasterize(p,layers="Points",dpi=300,dev="cairo_png")
    return(p)

})
### arrangeGrob() on the spotplot list --> 2x1 of plots from that list only, constituting the "first column" of the parent; leg.tmp2 is an additional thing being plotted in the second column of the parent.
pdf("plots/manuscript/Fig2/2A-Cluster_spotplots.pdf",height=3.5,width=4.25,onefile = FALSE)
do.call("grid.arrange", list(arrangeGrob(grobs = plts, ncol = 2, nrow = 2), leg.tmp, ncol = 2, widths = c(2.8, 1.2)))
dev.off()

rm(plts,tmpdat,tmpplt,leg.tmp,samps)
gc(full=T)
```

Fig 2B: Spot balance across E2/E4 • Sex • YRICEU groups (sharing legend with A and C)
```{r}
tmpcd <- as.data.table(colData(lc2))[,.(sample_id,Sex,APOE,YRI,label)]
tmpcd[,YRI:=ifelse(YRI>0.5,"AA","EA")]
tmpcd[,APOE:=ifelse(APOE %in% c("E4/ E4","E3/ E4"),"E4","E2")]
tmpcd[,group:=paste0(APOE, " ", YRI, " ",Sex)]

pltdat <- tmpcd[,.N,by=c("group","label")]
pltdat[,group:=factor(group,levels=c(
  "E4 AA F",
  "E4 AA M",
  "E4 EA M",
  "E2 AA F",
  "E2 AA M",
  "E2 EA F",
  "E2 EA M"
))]
pltdat[,totN:=sum(N),by="group"]
pltdat[,grouplabprop:=N/totN]

stopifnot(all(names(pal) %in% pltdat$label))

pdf("plots/manuscript/Fig2/2B_Domainprops_by_group.pdf",height=2.56,width=1.25,onefile = FALSE)
ggplot(pltdat,aes(x=group,y=grouplabprop,fill=label))+
  geom_col()+
  guides(fill="none")+
  scale_fill_manual(values = pal)+
  scale_y_continuous(limits=c(0,1),expand=c(0,0))+
  labs(x="Demographic Group",y="Proportion of Spots")+
  theme(
        axis.text.x=element_markdown(angle=45,hjust=1,vjust=1.1,size=8,colour = "#000000"),
        axis.text.y=element_text(size=8,colour = "#000000"),
        axis.title.x=element_text(size=9,colour = "#000000"),
        axis.title.y=element_text(size=9,colour = "#000000", margin=margin(0,0,0,-0.02,unit="in")),
        legend.title=element_text(size=8,hjust=0.5,colour = "#000000"),
        legend.text=element_text(size=7,colour = "#000000"),
        legend.background=element_blank(),
        legend.margin=margin(0,-0.08,0,-0.1,unit="in"),
        axis.ticks.x = element_line(linewidth=0.5,colour="#000000"),
        axis.ticks.y = element_line(linewidth=0.5,colour="#000000"),
        panel.grid.major.x = element_line(linewidth=0.5),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank()
  )
dev.off()
```

Fig 2C: marker heatmap
```{r}
### get markers
globalmk <- fread("processed-data/13_markers_and_registration_final/01-HDGSVG2575louv1_regWrapOut_1vAll_markers.txt")

globalmk <- globalmk[fdr<0.05&logFC>0]
# exclude mtrnrs and mitochondrials
globalmk <- globalmk[!(gene %in% grep(gene,pattern="MTRNR|MT-",value=T))]
## get top 5 genes, by logFC, per cluster
mkg <- unique(globalmk[ , .SD[order(-logFC) , ][1:5] , by = "cluster"][,.(ensembl,cluster)])

## reorder the palette/clusters here so that the sort of gradations between glial clusters are apparent
pal2 <- pal[c(1:5,8,7,9,6)]

## extract these genes in the reverse order of the palette'd clusters so that they appear top corner to bottom corner in resulting heatmap
for (cl in names(pal2)){
    if(cl==names(pal2)[1]){
        mkg2 <- mkg[cluster==cl,ensembl]
    } else {
        mkg2 <- unique(c(mkg2,mkg[cluster==cl,ensembl]))
    }
}
mkg<-mkg2

rm(globalmk,mkg2,cl)

# global marker heatmap: top 5 genes by LFC per cluster x 9 clusters = 45 genes (max)

# get scaled expression data for global heatmap
## define function to z-scale expression
# z scale rows, from tony https://github.com/LieberInstitute/spatial_DG_lifespan/blob/9419eb91453cda1df494d93dc91156d819042c66/code/Pseudobulk/top_infant_DE_heatmap_enrichment.R#L106

scale_rows <- function(x) {
    m <- apply(x, 1, mean, na.rm = T)
    s <- apply(x, 1, sd, na.rm = T)
    return((x - m) / s)
}


## we reversed the order for the cluster-gene pairs, so use the original cluster order in pal for col ordering
clusord <- names(pal2)

lc2$label <- factor(lc2$label,levels=clusord)

### drop uncertain samples
lc2 <- lc2[,!(lc2$brnum %in% paste0("Br",c(5517,5276,5712)))]
    
# make an spe with reordering of the columns to be in the order of the clusters we want plotted, then disable column clustering in the heatmap. (thatll make the plotting quicker too).
i <- 1
for (i in c(1:length(levels(lc2$label)))) {
    curlev <- levels(lc2$label)[i]
    if (i == 1) {
        cnames <- colnames(lc2[, lc2$label == curlev])
    } else {
        cnames <- c(cnames, colnames(lc2[, lc2$label == curlev]))
    }
}
rm(i, curlev)

### extract log counts per marker, z-normalize, hang onto both

lc2 <- scater::computeLibraryFactors(lc2)
lc2 <- scater::logNormCounts(lc2)
pltdat <- SingleCellExperiment(lc2[mkg, cnames],rowData=rowData(lc2[mkg,])) 

# ^ gets rid of imagedata here but screws up assays somehow
assays(pltdat)$counts <- assays(lc2[mkg,cnames])$counts
assays(pltdat)$logcounts <- assays(lc2[mkg,cnames])$logcounts

# dump the screwed up assays in slot 1
assays(pltdat) <- assays(pltdat)[c(2:3)]

# change rownames to gene symbols
rownames(pltdat) <- rowData(pltdat)$gene_name
pltdat2 <- scale_rows(as.matrix(logcounts(pltdat)))

## labels also got bllown away here -_-
louvs2 <- louvs[colnames(pltdat),]
pltdat$label <- louvs2$anno
pltdat$label <- factor(pltdat$label,levels=clusord)
```

# 2C-continued make the plot.
```{r}
# z score 99 %ile is 3point something. So we can just plot a symmetric -3,0,3 to get most of the variation in the significant things  

htmap <- ComplexHeatmap::Heatmap(
    pltdat2,
    top_annotation = HeatmapAnnotation(
        `Visium Cluster` = pltdat$label,
        show_annotation_name = FALSE,
        gap = 0,
        col = list(`Visium Cluster`=pal2),
        gp = gpar(alpha = 1,cex=0.35),
        annotation_legend_param = list(labels_gp=gpar(fontsize=7))
    ),
    show_column_names = FALSE,
    show_column_dend = FALSE,
    show_row_dend = FALSE,
    show_row_names = TRUE,
    col = colorRamp2(
        colors=c("blue","white","orange"),
        breaks = c(-3,0,3)
    ),
    cluster_columns = F, # handled by ordering the collumns of the spe above
    cluster_rows = F, #ibid
    heatmap_legend_param = list(
        title = "Z scored spot log counts",
        direction = "horizontal",
        title_position = "topcenter",
        at=c(-5,0,5) 
        # at argument forces the - region of the legend to show, it won't by default due to the long positive end 
    ),
    row_names_gp = gpar(fontsize = 5.5),
    raster_device = "CairoPNG",
    raster_quality = 10
)

### save plot; add title 

# unstack the legends in illustator; ital the gene names in illustrator.
CairoPDF("plots/manuscript/Fig2/2C-topSignifMarkersByLFC_heatmap.pdf", height = 4.5, width = 3.5)

draw(htmap,
    annotation_legend_side = "right",
    heatmap_legend_side = "bottom",
    legend_grouping = "original"
)
dev.off()

rm(pltdat,pltdat2,louvs2,gns,cnames,clusts,pal2,clusord,mkg,htmap)
```

Fig 2D: WeberDivecha registration. we ran this when vetting different clustering/feature approaches.
```{r}
webdivreg <- readRDS("processed-data/13_markers_and_registration_final/02-LC3_registration_to_WeberDivecha23_final.RDS")

## get the registration values when using the max number of genes in both this dataset and the current webdiv dataset (slot 22 of the respective labeling approach for whichever data of theirs)
pltdat <- list()
i<-1
for (i in c(1:length(webdivreg))){
    out <- as.data.table(webdivreg[[i]][[22]])
    out[,webdivdat:=names(webdivreg)[i]]
    out <- melt.data.table(out,id.vars=c("LFF_clus","webdivdat"))
    setnames(out,"variable","WebDiv_label")
    pltdat[[i]] <- out
}
rm(i,out)

pltdat <- rbindlist(pltdat)
pltdat[,webdivdat:=as.character(webdivdat)]
pltdat[,LFF_clus:=as.character(LFF_clus)]

## subset to our main pure-ish clusters and their corresponding snuc/spatial types
pltdat <- pltdat[
    # LFF_clus %in% c("LC","ACHE_SERT_LC_WM","ACHE_SERT_Npep","Astro","Oligo") 
    # & 
    WebDiv_label %in% c("label_merged_x5HT","label_merged_xastrocytes","label_merged_xinhibitory","label_merged_xexcitatory","label_merged_xoligodendrocytes","supervised_NE_TRUE","annot_spot_TRUE")]

## prettify
pltdat[,WebDiv_label:=gsub(WebDiv_label,pattern="label_merged_x",replacement="snSeq ")]
pltdat[WebDiv_label=="snSeq inhibitory",WebDiv_label:="snSeq Inhibitory"]
pltdat[WebDiv_label=="snSeq excitatory",WebDiv_label:="snSeq Excitatory"]
pltdat[WebDiv_label=="snSeq astrocytes",WebDiv_label:="snSeq Astrocytes"]
pltdat[WebDiv_label=="snSeq oligodendrocytes",WebDiv_label:="snSeq Oligo"]

pltdat[WebDiv_label=="supervised_NE_TRUE",WebDiv_label:="snSeq Manual NE"]
# pltdat[WebDiv_label=="unsupervised_5HT_TRUE",WebDiv_label:="snSeq Unsuperv. 5HT"]
# pltdat[WebDiv_label=="annot_region_TRUE",WebDiv_label:="Vis. LC Region, Manual"]
pltdat[WebDiv_label=="annot_spot_TRUE",WebDiv_label:="Vis. LC Spot, Manual"]


pltdat[,WebDiv_label:=factor(WebDiv_label,levels=c(paste0("snSeq ",c("Oligo", "Astrocytes", "5HT", "Inhibitory", "Excitatory", "Manual NE")),"Vis. LC Spot, Manual"))]

pltdat[,LFF_clus:=gsub(LFF_clus,pattern="_",replacement=" ")]
pltdat[,LFF_clus:=gsub(LFF_clus,pattern="ACHE",replacement="\\*ACHE\\*,")]
pltdat[,LFF_clus:=gsub(LFF_clus,pattern="SERT",replacement="\\*SERT\\*,")]
pltdat[LFF_clus=="Oligo Complex",LFF_clus:="Oligo-Others Mixed"]
pltdat[LFF_clus=="Astro Oligo",LFF_clus:="Astro-Oligo"]
pltdat[LFF_clus=="Oligo Astro",LFF_clus:="Oligo-Astro"]
pltdat[LFF_clus=="*ACHE*, *SERT*, LC WM",LFF_clus:="*ACHE*, *SERT*, LC, WM"]

pltdat[,LFF_clus:=factor(LFF_clus,levels=rev(c("Vascular","Oligo-Others Mixed","Oligo-Astro","Oligo","Astro-Oligo","Astro","*ACHE*, *SERT*, Npep","*ACHE*, *SERT*, LC, WM","LC")))]

## plot and save

pdf("plots/manuscript/Fig2/2D-WeberDivecha_registration_alldomains.pdf",height=3.5,width=3.5)
ggplot(pltdat,aes(x=LFF_clus,y=WebDiv_label,fill=value))+
    geom_tile()+
    scale_x_discrete(expand = c(0,0)) +
    scale_y_discrete(expand = c(0,0)) +
    # scale_fill_continuous(type="viridis",limits=c(min(pltdat$value),max(pltdat$value)))+
    scale_fill_gradient2(low="blue",mid = "white",high = "orange",
        midpoint=0)+
    labs(x="Domain (This Dataset)",y="LC-NE snSeq/Visium\n(Weber, Divecha 2023)",fill="Spearman Cor.\n(Top ~4500 En-\nriched Genes)")+
    theme(
        axis.text.x=element_markdown(angle=45,hjust=1,size=8,colour = "#000000"),
        axis.text.y=element_text(size=8,colour = "#000000"),
        axis.title.x=element_text(size=9,colour = "#000000"),
        axis.title.y=element_text(size=9,colour = "#000000", margin=margin(0,0,0,-0.02,unit="in")),
        legend.title=element_text(size=8,hjust=0.5,colour = "#000000"),
        legend.text=element_text(size=7,colour = "#000000"),
        legend.background=element_blank(),
        legend.margin=margin(0,-0.08,0,-0.1,unit="in")
    )
dev.off()

rm(pltdat)
```

repinf
```{r}
sessionInfo()
sessioninfo::session_info()
```
R version 4.4.3 (2025-02-28)
Platform: aarch64-apple-darwin20
Running under: macOS Sequoia 15.3.2

Matrix products: default
BLAS:   /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] grid      stats4    stats     graphics  grDevices utils     methods   base     

other attached packages:
 [1] BiocParallel_1.40.0         parallelly_1.43.0          
 [3] colorout_1.3-0.2            ggrepel_0.9.6              
 [5] viridis_0.6.5               viridisLite_0.4.2          
 [7] circlize_0.4.16             Cairo_1.6-2                
 [9] ComplexHeatmap_2.22.0       ggrastr_1.0.2              
[11] spatialLIBD_1.18.0          SpatialExperiment_1.16.0   
[13] SingleCellExperiment_1.28.1 SummarizedExperiment_1.36.0
[15] Biobase_2.66.0              GenomicRanges_1.58.0       
[17] GenomeInfoDb_1.42.3         IRanges_2.40.1             
[19] S4Vectors_0.44.0            BiocGenerics_0.52.0        
[21] MatrixGenerics_1.18.1       matrixStats_1.5.0          
[23] gridExtra_2.3               ggtext_0.1.2               
[25] ggplot2_3.5.2               data.table_1.17.0          
[27] rlang_1.1.5                

loaded via a namespace (and not attached):
  [1] later_1.4.2              BiocIO_1.16.0            bitops_1.0-9            
  [4] filelock_1.0.3           fields_16.3.1            tibble_3.2.1            
  [7] XML_3.99-0.18            lifecycle_1.0.4          edgeR_4.4.2             
 [10] doParallel_1.0.17        rprojroot_2.0.4          lattice_0.22-6          
 [13] magrittr_2.0.3           limma_3.62.2             plotly_4.10.4           
 [16] sass_0.4.10              rmarkdown_2.29           jquerylib_0.1.4         
 [19] yaml_2.3.10              httpuv_1.6.16            spam_2.11-1             
 [22] sessioninfo_1.2.3        cowplot_1.1.3            DBI_1.2.3               
 [25] RColorBrewer_1.1-3       golem_0.5.1              maps_3.4.2.1            
 [28] abind_1.4-8              zlibbioc_1.52.0          purrr_1.0.4             
 [31] RCurl_1.98-1.17          rappdirs_0.3.3           GenomeInfoDbData_1.2.13 
 [34] irlba_2.3.5.1            commonmark_1.9.5         codetools_0.2-20        
 [37] DelayedArray_0.32.0      DT_0.33                  scuttle_1.16.0          
 [40] xml2_1.3.8               tidyselect_1.2.1         shape_1.4.6.1           
 [43] UCSC.utils_1.2.0         farver_2.1.2             ScaledMatrix_1.14.0     
 [46] shinyWidgets_0.9.0       BiocFileCache_2.14.0     GenomicAlignments_1.42.0
 [49] jsonlite_2.0.0           GetoptLong_1.0.5         BiocNeighbors_2.0.1     
 [52] scater_1.34.1            iterators_1.0.14         foreach_1.5.2           
 [55] tools_4.4.3              Rcpp_1.0.14              glue_1.8.0              
 [58] SparseArray_1.6.2        xfun_0.52                here_1.0.1              
 [61] dplyr_1.1.4              withr_3.0.2              BiocManager_1.30.25     
 [64] fastmap_1.2.0            litedown_0.6             digest_0.6.37           
 [67] rsvd_1.0.5               R6_2.6.1                 mime_0.13               
 [70] colorspace_2.1-1         markdown_2.0             dichromat_2.0-0.1       
 [73] RSQLite_2.3.9            config_0.3.2             tidyr_1.3.1             
 [76] generics_0.1.3           rtracklayer_1.66.0       httr_1.4.7              
 [79] htmlwidgets_1.6.4        S4Arrays_1.6.0           pkgconfig_2.0.3         
 [82] gtable_0.3.6             blob_1.2.4               XVector_0.46.0          
 [85] htmltools_0.5.8.1        dotCall64_1.2            clue_0.3-66             
 [88] scales_1.4.0             png_0.1-8                attempt_0.3.1           
 [91] knitr_1.50               rstudioapi_0.17.1        rjson_0.2.23            
 [94] curl_6.2.2               cachem_1.1.0             GlobalOptions_0.1.2     
 [97] stringr_1.5.1            BiocVersion_3.20.0       parallel_4.4.3          
[100] vipor_0.4.7              AnnotationDbi_1.68.0     restfulr_0.0.15         
[103] pillar_1.10.2            vctrs_0.6.5              promises_1.3.2          
[106] BiocSingular_1.22.0      dbplyr_2.5.0             beachmat_2.22.0         
[109] cluster_2.1.8.1          xtable_1.8-4             beeswarm_0.4.0          
[112] paletteer_1.6.0          evaluate_1.0.3           magick_2.8.6            
[115] cli_3.6.4                locfit_1.5-9.12          compiler_4.4.3          
[118] Rsamtools_2.22.0         crayon_1.5.3             labeling_0.4.3          
[121] rematch2_2.1.2           ggbeeswarm_0.7.2         stringi_1.8.7           
[124] Biostrings_2.74.1        lazyeval_0.2.2           Matrix_1.7-3            
[127] ExperimentHub_2.14.0     benchmarkme_1.0.8        bit64_4.6.0-1           
[130] KEGGREST_1.46.0          statmod_1.5.0            shiny_1.10.0            
[133] AnnotationHub_3.14.0     gridtext_0.1.5           memoise_2.0.1           
[136] bslib_0.9.0              benchmarkmeData_1.0.4    bit_4.6.0               
> sessioninfo::session_info()
─ Session info ────────────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.4.3 (2025-02-28)
 os       macOS Sequoia 15.3.2
 system   aarch64, darwin20
 ui       RStudio
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       America/Chicago
 date     2025-05-24
 rstudio  2024.07.0-daily+219 Cranberry Hibiscus (desktop)
 pandoc   3.1.11 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/aarch64/ (via rmarkdown)
 quarto   1.4.555 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/quarto

─ Packages ────────────────────────────────────────────────────────────────────────
 !  package              * version   date (UTC) lib source
    abind                  1.4-8     2024-09-12 [1] CRAN (R 4.4.1)
    AnnotationDbi          1.68.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    AnnotationHub          3.14.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    attempt                0.3.1     2020-05-03 [1] CRAN (R 4.4.0)
    beachmat               2.22.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    beeswarm               0.4.0     2021-06-01 [1] CRAN (R 4.4.0)
    benchmarkme            1.0.8     2022-06-12 [1] CRAN (R 4.4.0)
    benchmarkmeData        1.0.4     2020-04-23 [1] CRAN (R 4.4.0)
    Biobase              * 2.66.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    BiocFileCache          2.14.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    BiocGenerics         * 0.52.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    BiocIO                 1.16.0    2024-12-12 [1] Github (Bioconductor/BiocIO@8e80624)
    BiocManager            1.30.25   2024-08-28 [1] CRAN (R 4.4.1)
    BiocNeighbors          2.0.1     2024-11-28 [1] Bioconductor 3.20 (R 4.4.2)
    BiocParallel         * 1.40.0    2024-11-23 [1] Bioconductor 3.20 (R 4.4.2)
    BiocSingular           1.22.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    BiocVersion            3.20.0    2024-05-04 [1] Bioconductor 3.20 (R 4.4.0)
    Biostrings             2.74.1    2024-12-16 [1] Bioconductor 3.20 (R 4.4.2)
    bit                    4.6.0     2025-03-06 [1] CRAN (R 4.4.1)
    bit64                  4.6.0-1   2025-01-16 [1] CRAN (R 4.4.1)
    bitops                 1.0-9     2024-10-03 [1] CRAN (R 4.4.1)
    blob                   1.2.4     2023-03-17 [1] CRAN (R 4.4.0)
    bslib                  0.9.0     2025-01-30 [1] CRAN (R 4.4.1)
    cachem                 1.1.0     2024-05-16 [1] CRAN (R 4.4.0)
    Cairo                * 1.6-2     2023-11-28 [1] CRAN (R 4.4.0)
    circlize             * 0.4.16    2024-02-20 [1] CRAN (R 4.4.0)
 VP cli                    3.6.4     2025-04-23 [2] CRAN (R 4.4.1) (on disk 3.6.5)
    clue                   0.3-66    2024-11-13 [1] CRAN (R 4.4.1)
    cluster                2.1.8.1   2025-03-12 [1] CRAN (R 4.4.1)
    codetools              0.2-20    2024-03-31 [1] CRAN (R 4.4.3)
    colorout             * 1.3-0.2   2024-05-01 [1] Github (jalvesaq/colorout@c6113a2)
    colorspace             2.1-1     2024-07-26 [1] CRAN (R 4.4.0)
    commonmark             1.9.5     2025-03-17 [1] CRAN (R 4.4.1)
    ComplexHeatmap       * 2.22.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    config                 0.3.2     2023-08-30 [1] CRAN (R 4.4.0)
    cowplot                1.1.3     2024-01-22 [1] CRAN (R 4.4.0)
    crayon                 1.5.3     2024-06-20 [1] CRAN (R 4.4.0)
    curl                   6.2.2     2025-03-24 [1] CRAN (R 4.4.1)
    data.table           * 1.17.0    2025-02-22 [1] CRAN (R 4.4.1)
    DBI                    1.2.3     2024-06-02 [1] CRAN (R 4.4.0)
    dbplyr                 2.5.0     2024-03-19 [1] CRAN (R 4.4.0)
    DelayedArray           0.32.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    dichromat              2.0-0.1   2022-05-02 [1] CRAN (R 4.4.0)
    digest                 0.6.37    2024-08-19 [1] CRAN (R 4.4.1)
    doParallel             1.0.17    2022-02-07 [1] CRAN (R 4.4.1)
    dotCall64              1.2       2024-10-04 [1] CRAN (R 4.4.1)
    dplyr                  1.1.4     2023-11-17 [1] CRAN (R 4.4.0)
    DT                     0.33      2024-04-04 [1] CRAN (R 4.4.0)
    edgeR                  4.4.2     2025-01-27 [1] Bioconductor 3.20 (R 4.4.2)
    evaluate               1.0.3     2025-01-10 [1] CRAN (R 4.4.1)
    ExperimentHub          2.14.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    farver                 2.1.2     2024-05-13 [1] CRAN (R 4.4.0)
    fastmap                1.2.0     2024-05-15 [1] CRAN (R 4.4.0)
    fields                 16.3.1    2025-03-08 [1] CRAN (R 4.4.1)
    filelock               1.0.3     2023-12-11 [1] CRAN (R 4.4.0)
    foreach                1.5.2     2022-02-02 [1] CRAN (R 4.4.0)
    generics               0.1.3     2022-07-05 [1] CRAN (R 4.4.0)
    GenomeInfoDb         * 1.42.3    2025-01-27 [1] Bioconductor 3.20 (R 4.4.2)
    GenomeInfoDbData       1.2.13    2024-12-12 [1] Bioconductor
    GenomicAlignments      1.42.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    GenomicRanges        * 1.58.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    GetoptLong             1.0.5     2020-12-15 [1] CRAN (R 4.4.0)
    ggbeeswarm             0.7.2     2023-04-29 [1] CRAN (R 4.4.0)
    ggplot2              * 3.5.2     2025-04-09 [1] CRAN (R 4.4.1)
    ggrastr              * 1.0.2     2023-06-01 [1] CRAN (R 4.4.0)
    ggrepel              * 0.9.6     2024-09-07 [1] CRAN (R 4.4.1)
    ggtext               * 0.1.2     2022-09-16 [1] CRAN (R 4.4.0)
    GlobalOptions          0.1.2     2020-06-10 [1] CRAN (R 4.4.0)
    glue                   1.8.0     2024-09-30 [1] CRAN (R 4.4.1)
    golem                  0.5.1     2024-08-27 [1] CRAN (R 4.4.1)
    gridExtra            * 2.3       2017-09-09 [1] CRAN (R 4.4.0)
    gridtext               0.1.5     2022-09-16 [1] CRAN (R 4.4.0)
    gtable                 0.3.6     2024-10-25 [1] CRAN (R 4.4.1)
    here                   1.0.1     2020-12-13 [1] CRAN (R 4.4.0)
    htmltools              0.5.8.1   2024-04-04 [1] CRAN (R 4.4.0)
    htmlwidgets            1.6.4     2023-12-06 [1] CRAN (R 4.4.0)
    httpuv                 1.6.16    2025-04-16 [1] CRAN (R 4.4.1)
    httr                   1.4.7     2023-08-15 [1] CRAN (R 4.4.0)
    IRanges              * 2.40.1    2024-12-05 [1] Bioconductor 3.20 (R 4.4.2)
    irlba                  2.3.5.1   2022-10-03 [1] CRAN (R 4.4.0)
    iterators              1.0.14    2022-02-05 [1] CRAN (R 4.4.0)
    jquerylib              0.1.4     2021-04-26 [1] CRAN (R 4.4.0)
    jsonlite               2.0.0     2025-03-27 [1] CRAN (R 4.4.1)
    KEGGREST               1.46.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    knitr                  1.50      2025-03-16 [1] CRAN (R 4.4.2)
    labeling               0.4.3     2023-08-29 [1] CRAN (R 4.4.0)
    later                  1.4.2     2025-04-08 [1] CRAN (R 4.4.1)
    lattice                0.22-6    2024-03-20 [1] CRAN (R 4.4.3)
    lazyeval               0.2.2     2019-03-15 [1] CRAN (R 4.4.0)
    lifecycle              1.0.4     2023-11-07 [1] CRAN (R 4.4.0)
    limma                  3.62.2    2025-01-09 [1] Bioconductor 3.20 (R 4.4.2)
    litedown               0.6       2025-02-27 [1] CRAN (R 4.4.3)
    locfit                 1.5-9.12  2025-03-05 [1] CRAN (R 4.4.1)
    magick                 2.8.6     2025-03-23 [1] CRAN (R 4.4.1)
    magrittr               2.0.3     2022-03-30 [1] CRAN (R 4.4.0)
    maps                   3.4.2.1   2024-11-10 [1] CRAN (R 4.4.1)
    markdown               2.0       2025-03-23 [1] CRAN (R 4.4.3)
    Matrix                 1.7-3     2025-03-11 [1] CRAN (R 4.4.1)
    MatrixGenerics       * 1.18.1    2025-01-09 [1] Bioconductor 3.20 (R 4.4.2)
    matrixStats          * 1.5.0     2025-01-07 [1] CRAN (R 4.4.1)
    memoise                2.0.1     2021-11-26 [1] CRAN (R 4.4.0)
    mime                   0.13      2025-03-17 [1] CRAN (R 4.4.1)
    paletteer              1.6.0     2024-01-21 [1] CRAN (R 4.4.0)
    parallelly           * 1.43.0    2025-03-24 [1] CRAN (R 4.4.1)
    pillar                 1.10.2    2025-04-05 [1] CRAN (R 4.4.1)
    pkgconfig              2.0.3     2019-09-22 [1] CRAN (R 4.4.0)
    plotly                 4.10.4    2024-01-13 [1] CRAN (R 4.4.0)
    png                    0.1-8     2022-11-29 [1] CRAN (R 4.4.0)
    promises               1.3.2     2024-11-28 [1] CRAN (R 4.4.1)
    purrr                  1.0.4     2025-02-05 [1] CRAN (R 4.4.1)
    R6                     2.6.1     2025-02-15 [1] CRAN (R 4.4.1)
    rappdirs               0.3.3     2021-01-31 [1] CRAN (R 4.4.0)
    RColorBrewer           1.1-3     2022-04-03 [1] CRAN (R 4.4.0)
    Rcpp                   1.0.14    2025-01-12 [1] CRAN (R 4.4.1)
    RCurl                  1.98-1.17 2025-03-22 [1] CRAN (R 4.4.1)
    rematch2               2.1.2     2020-05-01 [1] CRAN (R 4.4.0)
    restfulr               0.0.15    2022-06-16 [1] CRAN (R 4.4.0)
    rjson                  0.2.23    2024-09-16 [1] CRAN (R 4.4.1)
 VP rlang                * 1.1.5     2025-04-11 [2] CRAN (R 4.4.1) (on disk 1.1.6)
    rmarkdown              2.29      2024-11-04 [1] CRAN (R 4.4.1)
    rprojroot              2.0.4     2023-11-05 [1] CRAN (R 4.4.0)
    Rsamtools              2.22.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    RSQLite                2.3.9     2024-12-03 [1] CRAN (R 4.4.1)
    rstudioapi             0.17.1    2024-10-22 [1] CRAN (R 4.4.1)
    rsvd                   1.0.5     2021-04-16 [1] CRAN (R 4.4.0)
    rtracklayer            1.66.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    S4Arrays               1.6.0     2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    S4Vectors            * 0.44.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    sass                   0.4.10    2025-04-11 [1] CRAN (R 4.4.1)
    ScaledMatrix           1.14.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    scales                 1.4.0     2025-04-24 [1] CRAN (R 4.4.1)
    scater                 1.34.1    2025-03-03 [1] Bioconductor 3.20 (R 4.4.2)
    scuttle                1.16.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    sessioninfo            1.2.3     2025-02-05 [1] CRAN (R 4.4.1)
    shape                  1.4.6.1   2024-02-23 [1] CRAN (R 4.4.0)
    shiny                  1.10.0    2024-12-14 [1] CRAN (R 4.4.1)
    shinyWidgets           0.9.0     2025-02-21 [1] CRAN (R 4.4.1)
    SingleCellExperiment * 1.28.1    2024-11-23 [1] Bioconductor 3.20 (R 4.4.2)
    spam                   2.11-1    2025-01-20 [1] CRAN (R 4.4.1)
    SparseArray            1.6.2     2025-02-20 [1] Bioconductor 3.20 (R 4.4.2)
    SpatialExperiment    * 1.16.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    spatialLIBD          * 1.18.0    2024-11-07 [1] Bioconductor 3.20 (R 4.4.3)
    statmod                1.5.0     2023-01-06 [1] CRAN (R 4.4.0)
    stringi                1.8.7     2025-03-27 [1] CRAN (R 4.4.1)
    stringr                1.5.1     2023-11-14 [1] CRAN (R 4.4.0)
    SummarizedExperiment * 1.36.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    tibble                 3.2.1     2023-03-20 [1] CRAN (R 4.4.0)
    tidyr                  1.3.1     2024-01-24 [1] CRAN (R 4.4.0)
    tidyselect             1.2.1     2024-03-11 [1] CRAN (R 4.4.0)
    UCSC.utils             1.2.0     2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    vctrs                  0.6.5     2023-12-01 [1] CRAN (R 4.4.0)
    vipor                  0.4.7     2023-12-18 [1] CRAN (R 4.4.0)
    viridis              * 0.6.5     2024-01-29 [1] CRAN (R 4.4.0)
    viridisLite          * 0.4.2     2023-05-02 [1] CRAN (R 4.4.0)
    withr                  3.0.2     2024-10-28 [1] CRAN (R 4.4.1)
    xfun                   0.52      2025-04-02 [1] CRAN (R 4.4.1)
    XML                    3.99-0.18 2025-01-01 [1] CRAN (R 4.4.1)
    xml2                   1.3.8     2025-03-14 [1] CRAN (R 4.4.1)
    xtable                 1.8-4     2019-04-21 [1] CRAN (R 4.4.0)
    XVector                0.46.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    yaml                   2.3.10    2024-07-26 [1] CRAN (R 4.4.0)
    zlibbioc               1.52.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)

 [1] /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library
 [2] /Users/bmulvey/Library/R/arm64/4.4/library

 * ── Packages attached to the search path.
 V ── Loaded and on-disk version mismatch.
 P ── Loaded and on-disk path mismatch.

───────────────────────────────────────────────────────────────────────────────────
