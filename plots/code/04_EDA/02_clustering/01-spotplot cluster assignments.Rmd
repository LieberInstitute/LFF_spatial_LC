---
title: "01-spotplot cluster assignments"
author: "Bernard Mulvey"
date: "2023-10-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.height = 10,fig.width = 7,include = FALSE)
knitr::opts_chunk$set(fig.width=7,fig.height=10)
#### sets tab autocompletion for directories to begin from the directory containing the .Rproj session, instead of the script's directory if different
knitr::opts_knit$set(root.dir = here::here())

library(data.table)
library(Biostrings)
library(ggplot2)
library(gridExtra)
library(SpatialExperiment)
library(spatialLIBD)
require(colorout)
ColorOut()
options("styler.addins_style_transformer" = "biocthis::bioc_style()")

## change write.table to output a TSV without quotes or rownames by default
library(default)
default(write.table) <- list(row.names=F,col.names=T,sep='\t',quote=F)

theme_set(theme_bw()+theme(axis.text.x = element_text(size = 14), axis.title.x = element_text(size = 16), axis.text.y = element_text(size = 14), axis.title.y = element_text(size =16), plot.title = element_text(size = 20,hjust=0.5), strip.text = element_text(size=18), legend.text = element_text(size=10), legend.title = element_text(size=11,hjust=0.5)))
```

### examine the BS clusters
```{r}
lc2 <- readRDS("processed-data/04_EDA/0_preliminary subset/01-lc_spe_nomitofilt_200umi-130gene_nonLCsampsdropped_102923.RDS")

bsq10.i7500 <- DataFrame(bsq10.i7500)
rownames(bsq10.i7500) <- bsq10.i7500$rn
bsq10.i7500 <- bsq10.i7500[colnames(lc2),]
#bsq10.i7500$spatial.cluster <- paste0("X",bsq10.i7500$spatial.cluster)

colLabels(lc2) <- factor(bsq10.i7500[,3])
library(Polychrome)
pal <- Polychrome::palette36.colors(n = 18)[c(2:9,15,18)]
# next line is needed for consistency in color-cluster assignments between libdspatial and the generated legend below
names(pal) <- c(1:length(unique(lc2$label)))

plt <- vis_grid_clus(lc2,"label",pdf_file = NULL,return_plots = T,spatial=F,point_size = 2,auto_crop = T,sort_clust = F,colors = pal)
plt <- lapply(plt,FUN=function(x){
    y <-x+
        guides(colour = guide_legend(override.aes = list(size=6)))+
        theme(axis.title = element_blank(),axis.text = element_blank(),legend.title = element_text(size=16),legend.text=element_text(size=15),plot.title = element_text(size=14,hjust=0.5),strip.text=element_text(size=11),plot.subtitle = element_text(size=11))
    return(y)
})

library(gridExtra)
pdf("plots/04_EDA/0_preliminary subset/02_clustering/BS_k10_7500iter.pdf",height=30,width=30)
do.call("grid.arrange",plt)
dev.off()
```
