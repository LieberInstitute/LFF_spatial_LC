---
title: "09-AD_PD_Genes_GSEA_MulticlustDEnoMixClusts_LCNMde_LCNMF"
author: "Bernie Mulvey"
date: "2025-07-20"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.height = 10,fig.width = 7,include = FALSE)
knitr::opts_chunk$set(fig.width=7,fig.height=10)
#### sets tab autocompletion for directories to begin from the directory containing the .Rproj session, instead of the script's directory if different
knitr::opts_knit$set(root.dir = here::here())

library(data.table)
library(clusterProfiler) # otherwise fgsea parallelization doesnt seem to work
library(fgsea)

require(colorout)
ColorOut()
options("styler.addins_style_transformer" = "biocthis::bioc_style()")

## change write.table to output a TSV without quotes or rownames by default
library(default)
default(write.table) <- list(row.names=F,col.names=T,sep='\t',quote=F)

## enable forked parallel processing with BiocParallel::multicoreParam, future::, etc
library(parallel)
options(parallelly.supportsMulticore.disableOn="")
options(parallelly.fork.enable=TRUE)
library(parallelly)
library(BiocParallel)
options(bphost="localhost")
```

### Opentargets, Bellenguez gene set retrievals
```{r}
ots <- readRDS("raw-data/ref_data/OpenTargets_AD_PD/OpenTargs_AD_PD_min1_and_min2_evidencetype_genesets.RDS")
ots <- lapply(ots,function(x){x$symbol})

bellen <- fread("raw-data/ref_data/ADGWAS_Bellenguez22_ST5_ST20_ST24-27.txt")
# not all supp tabs had ensgs so symbols here as well
bellens <- split(bellen$symbol,bellen$method) # gene prioritization approach
bellens$allGenes <- unique(bellen$symbol)
bellens$allExceptNearestGene <- bellen[method!="NearestGene",symbol]
names(bellens) <- paste0("Bellenguez22_",names(bellens))

disgs <- c(ots,bellens)

rm(ots,bellen,bellens)
```

PART 1: get signed DE t stat vectors per cluster per test
```{r}
de2b <- readRDS("processed-data/12_DEanalyses_removedsampsAndFinalNMseg/02b-voomLmFit_objs_and_DE_tables_LabSex_LabE2vE4_LabSingleGenos_LabAnces_LabAncesE4E2_noMixClusts_YRIcontAndCat_JUL2025.RDS")

## we want continuous ancestry analyses, except for the ancestry-strat analysis
de2b2 <- list(sexlabel=de2b$cont_ances$sexlabel$detabs,E2E4label=de2b$cont_ances$E2E4label$detabs,ApoAllelesLabel=de2b$cont_ances$ApoAllelesLabel$detabs)
de2b2[[length(de2b2)+1]] <- de2b$cat_ances$AncesByLabel$detabs
names(de2b2)[length(de2b2)] <- "AncesByLabel"

de2b3 <- list()
i<-1
for (i in c(1:length(de2b2))){
    j<-1
    for (j in c(1:length(de2b2[[i]]))){
        de2b3[length(de2b3)+1] <- de2b2[[i]][j]
        names(de2b3)[length(de2b3)] <- names(de2b2[[i]])[j]
    }
    rm(j)
}
rm(i)

### drop sex chr genes from sex DE tests
de2b3[grep(names(de2b3),pattern="Sex",value=T)] <- lapply(de2b3[grep(names(de2b3),pattern="Sex",value=T)],FUN=function(x){
    x[!(chr %in% grep(chr,pattern="chrX|chrY",value=T))]})

### drop mito genes from all tests
de2b3 <- lapply(de2b3,FUN=function(x){
    x[!(chr %in% grep(chr,pattern="chrMT",value=T))]})

### get named, SIGNED vectors of DE t-stats from each test
### need to use gene symbols for compatibility with the TF-target sets
deres <- list()
i<-1
for (i in c(1:length(de2b3))){
    setnames(de2b3[[i]],"t","tstat")
    tmp <- copy(de2b3[[i]])[,.(gene_name,tstat)]
    
    dropg <- tmp[,.N,by="gene_name"][N>1,gene_name]
    tmp <- tmp[!(gene_name %in% dropg)]
    
    setorderv(tmp,"tstat",-1)
    ## get the stat column as a vector and give it the gene ids as names for fgsea
    ## note that since data.table (invisibly) uses list() for column data, its cleaner to just make the working table a data frame for this last bit
    tmp <- as.data.frame(tmp)
    v <- tmp$tstat
    names(v) <- tmp$gene_name
    deres[[length(deres)+1]] <- v
    names(deres)[length(deres)] <- names(de2b3)[i]
    rm(v,tmp)
}
rm(i,de2b,de2b2,dropg)
gc(full=T)
```


## add NM DE
```{r}
lcnmde <- fread("processed-data/12_DEanalyses_removedsampsAndFinalNMseg/04-LCNMpos_vs_LCNMneg_DE.txt")
# drop mito genes
lcnmde <- lcnmde[!(chr %in% "chrMT")]

# add to DE tabs list we return to for unsigned tests
de2b3$LCNMposVneg <- lcnmde

# add to signed vectors list
setnames(lcnmde,"t","tstat")
setorderv(lcnmde,"tstat",-1)
v <- lcnmde$tstat
names(v) <- lcnmde$gene_name

deres$LCNMposVneg <- v

rm(v)
```

# not run-NMF factors -- this doesn't seem to work. could be the loadings are so tiny in general
## get NMFs

## load the NMF results from LC spots; identify factors with relatively factor-specific gene loadings for many genes
```{r}
# # get gene metadata
# lc3 <- readRDS("processed-data/06-countsOnly_noImgData_QCed_SPE_split_to_tissSections.RDS")
# rddt <- as.data.table(rowData(lc3))
# rm(lc3)
# gc(full=T)
# 
# 
# ### now we can load and tackle the nmf results
# lc.nmf2 <- readRDS("processed-data/10_subclustering/07-lcnmf160_tol1e-9.RDS")
# lc.nmffilt <- readRDS("processed-data/10_subclustering/07b-lcnmf160_tol1e-9_rowSumLogctFilt18.RDS")
# 
# keepfacts <- fread("processed-data/12_DEanalyses_removedsampsAndFinalNMseg/06-LCNMF_factors_and_factorSpecGenes_min25specGenes.txt")
# keepfactsfilt <- fread("processed-data/12_DEanalyses_removedsampsAndFinalNMseg/06b-LCNMFLogCt18Filt_factors_and_factorSpecGenes_min25specGenes.txt")
# 
# w2 <- as.data.table(lc.nmf2$w,keep.rownames=T)
# keepn <- c("rn",unique(keepfacts$factor))
# w2 <- w2[,..keepn]
# 
# w2filt <- as.data.table(lc.nmffilt$w,keep.rownames=T)
# keepnfilt <- c("rn",unique(keepfactsfilt$factor))
# w2filt <- w2filt[,..keepnfilt]
# 
# rm(lc.nmf2,lc.nmffilt,keepn,keepnfilt,keepfacts,keepfactsfilt)
# # append gene symbols
# 
# w2 <- merge.data.table(w2,rddt[,.(gene_id,gene_name)],by.x="rn",by.y="gene_id")
# nameord <- c("rn","gene_name",names(w2)[!(names(w2) %in% c("rn","gene_name"))])
# w2 <- w2[,..nameord]
# setnames(w2,"rn","gene_id")
# 
# w2filt <- merge.data.table(w2filt,rddt[,.(gene_id,gene_name)],by.x="rn",by.y="gene_id")
# nameordfilt <- c("rn","gene_name",names(w2filt)[!(names(w2filt) %in% c("rn","gene_name"))])
# w2filt <- w2filt[,..nameordfilt]
# setnames(w2filt,"rn","gene_id")
# 
# ## only need to run one-sided GSEA (positive enrichment) on these using the full set of loadings for that factor to identify any pathways etc that are enriched in that factor's genes. the enrichment analyses, by nature of GSEA, will be weighted toward the genes with the highest loadings, and our pre-selection of factors here has ensured that these factors have relatively unique and strong loadings for numerous genes.
# 
# # drop duplicated genes and chrMT genes for running fgsea
# keepg <- w2[,.N,by="gene_name"][N==1,gene_name]
# keepi <- w2[,.N,by="gene_id"][N==1,gene_id]
# dropm <- rddt[chr=="chrMT",gene_name]
# dropmi <- rddt[chr=="chrMT",gene_id]
# w2b <- w2[gene_name %in% keepg&gene_id %in% keepi&!(gene_name %in% dropm) & !(gene_id %in% dropmi)]
# w2filtb <- w2filt[gene_name %in% keepg & gene_id %in% keepi & !(gene_name %in% dropm) & !(gene_id %in% dropmi)]
# 
# ## get loadings in descending order for each factor of interest, name with gene ids for msigdb or with gene symbols for TF-target testing
# unfiltnmfs <- lapply(names(w2b)[3:ncol(w2b)],function(k){
#     setorderv(w2b,cols = k,-1)
#    
#     # get the descending order loading vector, clone it to name by gene id or symb
#     v <- unlist(w2b[!is.na(k),..k])
#     names(v) <- w2b[!is.na(k),gene_name]
#     return(v)
# })
# names(unfiltnmfs) <- paste0(names(w2b)[3:ncol(w2b)],"_unfilt")
# 
# ## same for filtered
# filtnmfs <- lapply(names(w2filtb)[3:ncol(w2filtb)],function(k){
#     setorderv(w2filtb,cols = k,-1)
#    
#     # get the descending order loading vector, clone it to name by gene id or symb
#     v <- unlist(w2filtb[!is.na(k),..k])
#     names(v) <- w2filtb[!is.na(k),gene_name]
#     return(v)
# })
# names(filtnmfs) <- paste0(names(w2filtb)[3:ncol(w2filtb)],"_filt")
# 
# ### append the NMFs to the signed DE vectors list
# deres <- c(deres,unfiltnmfs,filtnmfs)
# 
# ### clean up before GSEA runs
# rm(w2,w2b,w2filt,w2filtb,rddt,keepg,keepi,nameord,nameordfilt,dropm,dropmi,filtnmfs,unfiltnmfs)
# gc(full=T)
```

### run fgsea-signed tests
### looping through each cluster-variable interaction (each run is very fast with 10 cpus in biocparallel, so just serially run 10cpu GSEA for each cluster)
### increase maxsize to 1000 to accomodate all disease gene sets (largest 779)
```{r}
gseares <- mapply(X=deres,Y=names(deres),SIMPLIFY=FALSE,FUN=function(X,Y){
  register(MulticoreParam())
   # if the test is an NMF, we only run one direction (positive) since the NMFs are already signed
   # get cond1-up enriched results
   z1<-fgseaMultilevel(pathways=disgs,stats = X,minSize = 15,maxSize = 1000,eps=0.0,nPermSimple = 50000,nproc=10,scoreType = "pos")
   # coonvert leadingedge to one long string (it's returned as a list which is not compatible with data.table)
   z1$leadingEdge <- as.character(z1$leadingEdge)
   z1$leadingEdge <- gsub(z1$leadingEdge,pattern="^c\\((.*)\\)$",replacement="\\1")
   z1$leadingEdge <- gsub(z1$leadingEdge,pattern='"',replacement='')
   
   # drop newlines from leadingEdge
   z1$leadingEdge <- gsub(z1$leadingEdge,pattern=", \n",replacement=", ")
   # somehow, one run of this sometimes doesnt get them all so repeat for good meas
   z1$leadingEdge <- gsub(z1$leadingEdge,pattern=", \n",replacement=", ")
   
   z1 <- as.data.table(z1)
   z1[,test:=Y]
   
   if(length(grep(Y,pattern="Sex",value=T))>0){
       z1[,dir:="male_up"]
   } else if(length(grep(Y,pattern="E4vE2",value=T))>0){
       z1[,dir:="E4carriers_up"]
   } else if(length(grep(Y,pattern="YRI",value=T))>0){
       z1[,dir:="YRI_up"]
   } else if(length(grep(Y,pattern="nmf",value=T))>0) {
       z1[,dir:="nmf_factor_enriched"]
   } else {
       z1[,dir:=gsub(Y,pattern="^.*_(E....)_vs_(.*)",replacement=paste0("\\1","_up_vs_","\\2"))]
   }
   
   # get condition 2-up (e.g., female-up) enriched results; not necess for NMFs
   if (length(grep(Y,pattern="nmf",value=T))>0){
       z2 <- copy(z1[1,])
       z2[,dir:="dummy"]
   } else {
       register(MulticoreParam())
       z2<-fgseaMultilevel(pathways=disgs,stats = X,minSize = 15,maxSize = 1000,eps=0.0,nPermSimple = 50000,nproc=10,scoreType = "neg")
       # coonvert leadingedge to one long string (it's returned as a list which is not compatible with data.table)
       z2$leadingEdge <- as.character(z2$leadingEdge)
       z2$leadingEdge <- gsub(z2$leadingEdge,pattern="^c\\((.*)\\)$",replacement="\\1")
       z2$leadingEdge <- gsub(z2$leadingEdge,pattern='"',replacement='')
       
       # drop newlines from leadingEdge
       z2$leadingEdge <- gsub(z2$leadingEdge,pattern=", \n",replacement=", ")
       # somehow, one run of this sometimes doesnt get them all so repeat for good meas
       z2$leadingEdge <- gsub(z2$leadingEdge,pattern=", \n",replacement=", ")
       
       z2 <- as.data.table(z2)
       z2[,test:=Y]
       
        if(length(grep(Y,pattern="Sex",value=T))>0){
           z2[,dir:="female_up"]
       } else if(length(grep(Y,pattern="E4vE2",value=T))>0){
           z2[,dir:="E4carriers_down"]
       } else if(length(grep(Y,pattern="YRI",value=T))>0){
           z2[,dir:="YRI_down"]
       } else {
           z2[,dir:=gsub(Y,pattern="^.*_(E....)_vs_(.*)",replacement=paste0("\\1","_down_vs_","\\2"))]
       }
   }

   z <- as.data.table(rbind(z1,z2))
   z <- z[dir!="dummy"] # remove results from a placeholder output table for NMF cases
   return(z)
})
names(gseares) <- names(deres)

saveRDS(gseares,"processed-data/12_DEanalyses_removedsampsAndFinalNMseg/09_AD_PD_GSEA_MulticlustNoMixClustsDE_NMposnegDE_LCNMFs.RDS")

rm(deres,gseares)
```


### PART 2: get UNsigned DE t stat vectors per cluster per test
```{r}
### get named, UNsigned vectors of DE t-stats from each test
deres2 <- list()
i<-1
for (i in c(1:length(de2b3))){
    tmp <- de2b3[[i]][,.(gene_name,abs(tstat))]
    setnames(tmp,2,"tstat")
    setorderv(tmp,"tstat",-1)
    ## get the stat column as a vector and give it the gene ids as names for fgsea
    ## note that since data.table (invisibly) uses list() for column data, its cleaner to just make the working table a data frame for this last bit
    tmp <- as.data.frame(tmp)
    v <- tmp$tstat
    names(v) <- tmp$gene_name
    deres2[[length(deres2)+1]] <- v
    names(deres2)[length(deres2)] <- names(de2b3)[i]
    rm(v,tmp)
}
rm(i)

rm(tmp,v,lcnmde)
gc(full=T)
```

run UNSIGNED fgsea (genes that tend to be affected, regardless of direction)
### increase maxsize to 1000 to accomodate all disease gene sets
```{r}
gseares.unsign <- mapply(X=deres2,Y=names(deres2),SIMPLIFY=FALSE,FUN=function(X,Y){
   register(MulticoreParam())
   
   # get DE-enriched results
   z1<-fgseaMultilevel(pathways=disgs,stats = X,minSize = 15,maxSize = 1000,eps=0.0,nPermSimple = 50000,nproc=10,scoreType = "pos")
   
   # coonvert leadingedge to one long string (it's returned as a list which is not compatible with data.table)
   z1$leadingEdge <- as.character(z1$leadingEdge)
   z1$leadingEdge <- gsub(z1$leadingEdge,pattern="^c\\((.*)\\)$",replacement="\\1")
   z1$leadingEdge <- gsub(z1$leadingEdge,pattern='"',replacement='')
   # drop newlines from leadingEdge
   z1$leadingEdge <- gsub(z1$leadingEdge,pattern=", \n",replacement=", ")
   # belt and suspenders
   z1$leadingEdge <- gsub(z1$leadingEdge,pattern=", \n",replacement=", ")
   
   z1 <- as.data.table(z1)
   z1[,test:=Y]
   z1[,dir:="either"]
   
   return(z1)
})

names(gseares.unsign) <- names(deres2)

saveRDS(gseares.unsign,"processed-data/12_DEanalyses_removedsampsAndFinalNMseg/09_AD_PD_GSEA_MulticlustNoMixClustsDE_NMposnegDE_unsigned.RDS")
```

rep inf
```{r}
sessionInfo()
sessioninfo::session_info()
```
R version 4.4.3 (2025-02-28)
Platform: aarch64-apple-darwin20
Running under: macOS Sequoia 15.3.2

Matrix products: default
BLAS:   /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] parallel  stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] BiocParallel_1.40.0    parallelly_1.43.0      default_1.0.0          colorout_1.3-0.2      
[5] fgsea_1.32.4           clusterProfiler_4.14.6 data.table_1.17.4      rlang_1.1.5           

loaded via a namespace (and not attached):
 [1] DBI_1.2.3               gson_0.1.0              magrittr_2.0.3         
 [4] DOSE_4.0.0              compiler_4.4.3          RSQLite_2.3.9          
 [7] png_0.1-8               vctrs_0.6.5             reshape2_1.4.4         
[10] stringr_1.5.1           pkgconfig_2.0.3         crayon_1.5.3           
[13] fastmap_1.2.0           XVector_0.46.0          rmarkdown_2.29         
[16] enrichplot_1.26.6       UCSC.utils_1.2.0        purrr_1.0.4            
[19] bit_4.6.0               xfun_0.52               zlibbioc_1.52.0        
[22] cachem_1.1.0            aplot_0.2.5             GenomeInfoDb_1.42.3    
[25] jsonlite_2.0.0          blob_1.2.4              R6_2.6.1               
[28] stringi_1.8.7           RColorBrewer_1.1-3      GOSemSim_2.32.0        
[31] Rcpp_1.0.14             knitr_1.50              ggtangle_0.0.6         
[34] R.utils_2.13.0          IRanges_2.40.1          Matrix_1.7-3           
[37] splines_4.4.3           igraph_2.1.4            tidyselect_1.2.1       
[40] qvalue_2.38.0           rstudioapi_0.17.1       dichromat_2.0-0.1      
[43] yaml_2.3.10             codetools_0.2-20        lattice_0.22-6         
[46] tibble_3.2.1            plyr_1.8.9              Biobase_2.66.0         
[49] treeio_1.30.0           KEGGREST_1.46.0         evaluate_1.0.3         
[52] gridGraphics_0.5-1      Biostrings_2.74.1       pillar_1.10.2          
[55] ggtree_3.14.0           stats4_4.4.3            ggfun_0.1.8            
[58] generics_0.1.4          rprojroot_2.0.4         S4Vectors_0.44.0       
[61] ggplot2_3.5.2           scales_1.4.0            tidytree_0.4.6         
[64] glue_1.8.0              lazyeval_0.2.2          tools_4.4.3            
[67] fs_1.6.6                fastmatch_1.1-6         cowplot_1.1.3          
[70] grid_4.4.3              tidyr_1.3.1             ape_5.8-1              
[73] AnnotationDbi_1.68.0    colorspace_2.1-1        nlme_3.1-167           
[76] GenomeInfoDbData_1.2.13 patchwork_1.3.0         cli_3.6.4              
[79] dplyr_1.1.4             gtable_0.3.6            R.methodsS3_1.8.2      
[82] yulab.utils_0.2.0       digest_0.6.37           BiocGenerics_0.52.0    
[85] ggrepel_0.9.6           ggplotify_0.1.2         farver_2.1.2           
[88] memoise_2.0.1           htmltools_0.5.8.1       R.oo_1.27.0            
[91] lifecycle_1.0.4         httr_1.4.7              here_1.0.1             
[94] GO.db_3.20.0            bit64_4.6.0-1          
> sessioninfo::session_info()
─ Session info ───────────────────────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.4.3 (2025-02-28)
 os       macOS Sequoia 15.3.2
 system   aarch64, darwin20
 ui       RStudio
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       America/Chicago
 date     2025-07-21
 rstudio  2024.07.0-daily+219 Cranberry Hibiscus (desktop)
 pandoc   3.1.11 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/aarch64/ (via rmarkdown)
 quarto   1.4.555 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/quarto

─ Packages ───────────────────────────────────────────────────────────────────────────────────
 !  package          * version date (UTC) lib source
    AnnotationDbi      1.68.0  2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    ape                5.8-1   2024-12-16 [1] CRAN (R 4.4.1)
    aplot              0.2.5   2025-02-27 [1] CRAN (R 4.4.1)
    Biobase            2.66.0  2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    BiocGenerics       0.52.0  2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    BiocParallel     * 1.40.0  2024-11-23 [1] Bioconductor 3.20 (R 4.4.2)
    Biostrings         2.74.1  2024-12-16 [1] Bioconductor 3.20 (R 4.4.2)
    bit                4.6.0   2025-03-06 [1] CRAN (R 4.4.1)
    bit64              4.6.0-1 2025-01-16 [1] CRAN (R 4.4.1)
    blob               1.2.4   2023-03-17 [1] CRAN (R 4.4.0)
    cachem             1.1.0   2024-05-16 [1] CRAN (R 4.4.0)
 VP cli                3.6.4   2025-04-23 [2] CRAN (R 4.4.1) (on disk 3.6.5)
    clusterProfiler  * 4.14.6  2025-02-27 [1] Bioconductor 3.20 (R 4.4.2)
    codetools          0.2-20  2024-03-31 [1] CRAN (R 4.4.3)
    colorout         * 1.3-0.2 2024-05-01 [1] Github (jalvesaq/colorout@c6113a2)
    colorspace         2.1-1   2024-07-26 [1] CRAN (R 4.4.0)
    cowplot            1.1.3   2024-01-22 [1] CRAN (R 4.4.0)
    crayon             1.5.3   2024-06-20 [1] CRAN (R 4.4.0)
    data.table       * 1.17.4  2025-05-26 [1] CRAN (R 4.4.3)
    DBI                1.2.3   2024-06-02 [1] CRAN (R 4.4.0)
    default          * 1.0.0   2017-08-07 [1] CRAN (R 4.4.0)
    dichromat          2.0-0.1 2022-05-02 [1] CRAN (R 4.4.0)
    digest             0.6.37  2024-08-19 [1] CRAN (R 4.4.1)
    DOSE               4.0.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    dplyr              1.1.4   2023-11-17 [1] CRAN (R 4.4.0)
    enrichplot         1.26.6  2025-01-09 [1] Bioconductor 3.20 (R 4.4.2)
    evaluate           1.0.3   2025-01-10 [1] CRAN (R 4.4.1)
    farver             2.1.2   2024-05-13 [1] CRAN (R 4.4.0)
    fastmap            1.2.0   2024-05-15 [1] CRAN (R 4.4.0)
    fastmatch          1.1-6   2024-12-23 [1] CRAN (R 4.4.1)
    fgsea            * 1.32.4  2025-03-20 [1] Bioconductor 3.20 (R 4.4.3)
    fs                 1.6.6   2025-04-12 [1] CRAN (R 4.4.1)
    generics           0.1.4   2025-05-09 [1] CRAN (R 4.4.1)
    GenomeInfoDb       1.42.3  2025-01-27 [1] Bioconductor 3.20 (R 4.4.2)
    GenomeInfoDbData   1.2.13  2024-12-12 [1] Bioconductor
    ggfun              0.1.8   2024-12-03 [1] CRAN (R 4.4.1)
    ggplot2            3.5.2   2025-04-09 [1] CRAN (R 4.4.1)
    ggplotify          0.1.2   2023-08-09 [1] CRAN (R 4.4.0)
    ggrepel            0.9.6   2024-09-07 [1] CRAN (R 4.4.1)
    ggtangle           0.0.6   2024-12-18 [1] CRAN (R 4.4.1)
    ggtree             3.14.0  2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    glue               1.8.0   2024-09-30 [1] CRAN (R 4.4.1)
    GO.db              3.20.0  2024-12-12 [1] Bioconductor
    GOSemSim           2.32.0  2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    gridGraphics       0.5-1   2020-12-13 [1] CRAN (R 4.4.0)
    gson               0.1.0   2023-03-07 [1] CRAN (R 4.4.0)
    gtable             0.3.6   2024-10-25 [1] CRAN (R 4.4.1)
    here               1.0.1   2020-12-13 [1] CRAN (R 4.4.0)
    htmltools          0.5.8.1 2024-04-04 [1] CRAN (R 4.4.0)
    httr               1.4.7   2023-08-15 [1] CRAN (R 4.4.0)
    igraph             2.1.4   2025-01-23 [1] CRAN (R 4.4.1)
    IRanges            2.40.1  2024-12-05 [1] Bioconductor 3.20 (R 4.4.2)
    jsonlite           2.0.0   2025-03-27 [1] CRAN (R 4.4.1)
    KEGGREST           1.46.0  2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    knitr              1.50    2025-03-16 [1] CRAN (R 4.4.2)
    lattice            0.22-6  2024-03-20 [1] CRAN (R 4.4.3)
    lazyeval           0.2.2   2019-03-15 [1] CRAN (R 4.4.0)
    lifecycle          1.0.4   2023-11-07 [1] CRAN (R 4.4.0)
    magrittr           2.0.3   2022-03-30 [1] CRAN (R 4.4.0)
    Matrix             1.7-3   2025-03-11 [1] CRAN (R 4.4.1)
    memoise            2.0.1   2021-11-26 [1] CRAN (R 4.4.0)
    nlme               3.1-167 2025-01-27 [1] CRAN (R 4.4.3)
    parallelly       * 1.43.0  2025-03-24 [1] CRAN (R 4.4.1)
    patchwork          1.3.0   2024-09-16 [1] CRAN (R 4.4.1)
    pillar             1.10.2  2025-04-05 [1] CRAN (R 4.4.1)
    pkgconfig          2.0.3   2019-09-22 [1] CRAN (R 4.4.0)
    plyr               1.8.9   2023-10-02 [1] CRAN (R 4.4.0)
    png                0.1-8   2022-11-29 [1] CRAN (R 4.4.0)
    purrr              1.0.4   2025-02-05 [1] CRAN (R 4.4.1)
    qvalue             2.38.0  2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    R.methodsS3        1.8.2   2022-06-13 [1] CRAN (R 4.4.0)
    R.oo               1.27.0  2024-11-01 [1] CRAN (R 4.4.1)
    R.utils            2.13.0  2025-02-24 [1] CRAN (R 4.4.1)
    R6                 2.6.1   2025-02-15 [1] CRAN (R 4.4.1)
    RColorBrewer       1.1-3   2022-04-03 [1] CRAN (R 4.4.0)
    Rcpp               1.0.14  2025-01-12 [1] CRAN (R 4.4.1)
    reshape2           1.4.4   2020-04-09 [1] CRAN (R 4.4.0)
 VP rlang            * 1.1.5   2025-04-11 [2] CRAN (R 4.4.1) (on disk 1.1.6)
    rmarkdown          2.29    2024-11-04 [1] CRAN (R 4.4.1)
    rprojroot          2.0.4   2023-11-05 [1] CRAN (R 4.4.0)
    RSQLite            2.3.9   2024-12-03 [1] CRAN (R 4.4.1)
    rstudioapi         0.17.1  2024-10-22 [1] CRAN (R 4.4.1)
    S4Vectors          0.44.0  2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    scales             1.4.0   2025-04-24 [1] CRAN (R 4.4.1)
    sessioninfo        1.2.3   2025-02-05 [1] CRAN (R 4.4.1)
    stringi            1.8.7   2025-03-27 [1] CRAN (R 4.4.1)
    stringr            1.5.1   2023-11-14 [1] CRAN (R 4.4.0)
    tibble             3.2.1   2023-03-20 [1] CRAN (R 4.4.0)
    tidyr              1.3.1   2024-01-24 [1] CRAN (R 4.4.0)
    tidyselect         1.2.1   2024-03-11 [1] CRAN (R 4.4.0)
    tidytree           0.4.6   2023-12-12 [1] CRAN (R 4.4.0)
    treeio             1.30.0  2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    UCSC.utils         1.2.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    vctrs              0.6.5   2023-12-01 [1] CRAN (R 4.4.0)
    xfun               0.52    2025-04-02 [1] CRAN (R 4.4.1)
    XVector            0.46.0  2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
    yaml               2.3.10  2024-07-26 [1] CRAN (R 4.4.0)
    yulab.utils        0.2.0   2025-01-29 [1] CRAN (R 4.4.1)
    zlibbioc           1.52.0  2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)

 [1] /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library
 [2] /Users/bmulvey/Library/R/arm64/4.4/library

 * ── Packages attached to the search path.
 V ── Loaded and on-disk version mismatch.
 P ── Loaded and on-disk path mismatch.

──────────────────────────────────────────────────────────────────────────────────────────────
