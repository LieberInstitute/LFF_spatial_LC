---
title: "01-Registration_to_WeberDivecha23"
author: "Bernie Mulvey"
date: "2025-01-24"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.height = 10,fig.width = 7,include = FALSE)
#### sets tab autocompletion for directories to begin from the directory containing the .Rproj session, instead of the script's directory if different
knitr::opts_knit$set(root.dir = here::here())

library(data.table)
library(ggplot2)
library(ggtext)
library(gridExtra)
library(SpatialExperiment)
library(spatialLIBD)
library(WeberDivechaLCdata)

## rstudio GUI tweaks
require(colorout)
ColorOut()
options("styler.addins_style_transformer" = "biocthis::bioc_style()")
##

## enable forked parallel processing with BiocParallel::multicoreParam, future::, etc. seemed to need this a couple times, but otherwise havent so its here as a preventative measure. part of this is adding the line 
# OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES
# to Renviron.site. see e.g. top response on https://stackoverflow.com/questions/73638290/python-on-mac-is-it-safe-to-set-objc-disable-initialize-fork-safety-yes-globall 
library(parallelly)
options(parallelly.supportsMulticore.disableOn="")
options(parallelly.fork.enable=TRUE)
library(BiocParallel)
options(bphost="localhost")
library(parallel)


## ggplot defaults
theme_set(theme_bw()+theme(axis.text.x = element_text(size = 9), axis.title.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.y = element_text(size =9), plot.title = element_markdown(size = 11,hjust=0.5), strip.text = element_text(size=11), legend.text = element_text(size=8), legend.title = element_text(size=9,hjust=0.5)))

## last of all, unload the base package datasets, whose data keep getting in the way of autocompletions (e.g., Theoph is priortized over TRUE)
unloadNamespace("datasets")
```

## load SPE and assign hdg_svg_2575_louv_res1 clusterings as autoannotated (to start with), weber divecha lc datasets, 
```{r}
lc3 <- readRDS("processed-data/06-countsOnly_noImgData_QCed_SPE_split_to_tissSections.RDS")

louvs <- readRDS("processed-data/07_featureSelection_dimred_harmony_clustering/04-Initial_louvLeid_res0.5-1-2_clusterings.RDS")
louvs <- louvs[["HARMONYlmbna_HDG_SVG_2575"]][,.(rn,snnHARMONYlmbna_HDG_SVG_2575_louv_res1)]
setnames(louvs,2,"clusid")

autoan <- readRDS("processed-data/07_featureSelection_dimred_harmony_clustering/05b-init_clusterings_autoannoLCrapheAndGABAergic.RDS")
autoan <- autoan[["snnHARMONYlmbna_HDG_SVG_2575_louv_res1"]]

louvs <- merge.data.table(louvs,autoan,by="clusid")
louvs <- DataFrame(louvs,row.names=louvs$rn)[colnames(lc3),]

colLabels(lc3) <- louvs$autoanno

rm(louvs,autoan)
```

## weber divecha datasets
```{r}
webdvis <- WeberDivechaLCdata_Visium()
webdsn <- WeberDivechaLCdata_singleNucleus()
```

## "spatially register" between the lc3 clusterings and each clustering in each weber divecha dataset
```{r}
# fix leading digit in the label_merged column
webdsn$label_merged <- paste0("x",webdsn$label_merged)

webdsn.wraps <- lapply(c("label_merged","unsupervised_NE","unsupervised_5HT","supervised_NE"),FUN=function(x){
    if(length(unique(colData(webdsn)[,x]))==2){
        colData(webdsn)[,x][colData(webdsn)[,x]==TRUE] <- "x1"
        colData(webdsn)[,x][colData(webdsn)[,x]==FALSE] <- "x0"
    }
    colLabels(webdsn) <- as.character(colData(webdsn)[,x]) # accounts for boolean labels
    rap <- registration_wrapper(webdsn,var_registration = "label",var_sample_id = "Sample",gene_ensembl = "gene_id",gene_name = "gene_name")
    return(rap)
})

names(webdsn.wraps) <- c("label_merged","unsupervised_NE","unsupervised_5HT","supervised_NE")
```

## for the visium there's just two binary labelings: whether a spot is part of the LC region and whether the spot itself is an LC spot
```{r}
webdvis.wraps <- lapply(c("annot_region","annot_spot"),FUN=function(x){
    if(length(unique(colData(webdvis)[,x]))==2){
        colData(webdvis)[,x][colData(webdvis)[,x]==TRUE] <- "x1"
        colData(webdvis)[,x][colData(webdvis)[,x]==FALSE] <- "x0"
    }
    colLabels(webdvis) <- as.character(colData(webdvis)[,x]) # accounts for boolean labels
    rap <- registration_wrapper(webdvis,var_registration = "label",var_sample_id = "sample_id",gene_ensembl = "gene_id",gene_name = "gene_name")
    return(rap)
})

names(webdvis.wraps) <- c("annot_region","annot_spot")
```

reg wrapper for lc3:
```{r}
colLabels(lc3) <- paste0("x",lc3$label)

lc3wrap <- registration_wrapper(lc3,var_registration = "label",var_sample_id = "sample_id",gene_ensembl = "gene_id",gene_name = "gene_name")
```

## clean up:
```{r}
rm(webdsn,webdvis)
gc(full=T)
```

## the actual registration (marker t stat correlation) component of spatialLIBD has never worked out of the box in my hands so we'll port over some code that basically rewrote those functions to actually function (and cover multiple sets of data being registered to / multiple sizes of top markers being registered to) (https://github.com/LieberInstitute/spatial_HYP/blob/e017cac5d2cc633dc668ad7cb4c906960d19f9de/xenium_HYP/code/10_Spatial_Registration/01_Yao23_MouseHYP_Subclass_SpatialReg.Rmd)

## first, we arrange each enrichment slot of each registration wrapper run into a gene - cluster x t stat - cluster y t stat - ... table and strip the "t-stat" part out of the column names
```{r}
### for lc3:
lc3.mk <- as.data.table(lc3wrap$enrichment)
keepcols <- c("ensembl",grep(names(lc3.mk),pattern="^t_stat_",value=T))
lc3.mk <- lc3.mk[,..keepcols]
    
setnames(lc3.mk,c(2:ncol(lc3.mk)),gsub(names(lc3.mk)[c(2:ncol(lc3.mk))],pattern="^t_stat_",replacement=""))

### for each slot in the weber divecha spatial data (replace x1 with TRUE and x0 with FALSE in the column names here too)
webdvis.wraps2 <- mapply(x=webdvis.wraps,y=names(webdvis.wraps),SIMPLIFY=FALSE,FUN=function(x,y){
    z <- as.data.table(x$enrichment)
    keepcols <- c("ensembl",grep(names(z),pattern="^t_stat_",value=T))
    z <- z[,..keepcols]
    
    setnames(z,c(2:ncol(z)),gsub(names(z)[c(2:ncol(z))],pattern="^t_stat_",replacement=paste0(y,"_")))
    setnames(z,c(2:ncol(z)),gsub(names(z)[c(2:ncol(z))],pattern="x1",replacement="TRUE"))
    setnames(z,c(2:ncol(z)),gsub(names(z)[c(2:ncol(z))],pattern="x0",replacement="FALSE"))
    
    return(z)
})

### append spat to the front of these names so we run the visium and snuc data thru one list
names(webdvis.wraps2) <- paste0("spat_",names(webdvis.wraps2))


webdsn.wraps2 <- mapply(x=webdsn.wraps,y=names(webdsn.wraps),SIMPLIFY=FALSE,FUN=function(x,y){
    z <- as.data.table(x$enrichment)
    keepcols <- c("ensembl",grep(names(z),pattern="^t_stat_",value=T))
    z <- z[,..keepcols]
    
    setnames(z,c(2:ncol(z)),gsub(names(z)[c(2:ncol(z))],pattern="^t_stat_",replacement=paste0(y,"_")))
    ### the x0/x1 convention is just for the boolean clusterings, so
    if(length(keepcols)==3){
        setnames(z,c(2:ncol(z)),gsub(names(z)[c(2:ncol(z))],pattern="x1",replacement="TRUE"))
        setnames(z,c(2:ncol(z)),gsub(names(z)[c(2:ncol(z))],pattern="x0",replacement="FALSE"))
    }
    
    return(z)
})

### append snuc to the front of these names so we run the visium and snuc data thru one list
names(webdsn.wraps2) <- paste0("snuc_",names(webdsn.wraps2))

allwebd <- c(webdsn.wraps2,webdvis.wraps2)
rm(webdsn.wraps,webdsn.wraps2,webdvis.wraps,webdvis.wraps2,lc3wrap)
gc(full=T)
```

## now the rewritten registration function
```{r}
m <- copy(lc3.mk)

spatregs <- mcmapply(s=allwebd,z=names(allwebd),SIMPLIFY=FALSE,mc.cores=3,FUN = function(s,z){
    # iterator for top number of genes to use for correlation
    j<-c(seq(10,50,10),seq(75,250,25),seq(300,1000,100))
    i<-1
    outlist <- list()
    for (i in c(1:(length(j)+1))){
        if(i<length(j)){
            cortab<-merge.data.table(m,s,by="ensembl")
            ngene <- j[i]
        }
        else{
            # no value for top_n --> all genes used
            cortab<-merge.data.table(m,s,by="ensembl")
            ngene <- nrow(cortab)
        }
        # initialize cormat
        nclaba <- ncol(s)
        nclhyp <- ncol(m)
        cormat <- as.data.frame(matrix(nrow=(nclhyp-1),ncol=(nclaba-1)))
        k <- 2
        for (k in c(2:nclhyp)){
            rownames(cormat)[(k-1)] <- colnames(m)[k]
            l <- 2
            for (l in c(2:nclaba)){
                colnames(cormat)[(l-1)] <- colnames(s)[l]
                
                curhyp <- colnames(m)[k]
                curaba <- colnames(s)[l]
                setorderv(cortab,curhyp,-1)
                
                cormat[(k-1),(l-1)] <- cor(cortab[c(1:ngene),..curhyp],cortab[c(1:ngene),..curaba],use="pairwise.complete.obs",method = "spearman")
            }
        }
        plttab <- as.data.table(cormat,keep.rownames=T)
        setnames(plttab,"rn","LFF_clus")
        outlist[[i]] <- plttab
        names(outlist)[i] <- paste0("Webdiv_",z,"_top_",ngene)
        rm(curj,plttab,cortab)
    }
    return(outlist)
})
```

save this output to process further into plottable format by clustering approach (top level list)
```{r}
saveRDS(spatregs,"processed-data/08_validitycheck_25hdg75svg_louv1/01-LC3_registration_to_WeberDivecha23.RDS")
```

rep inf
```{r}
sessionInfo()
sessioninfo::session_info()
```
R version 4.4.1 RC (2024-06-06 r86719)
Platform: aarch64-apple-darwin20
Running under: macOS Sonoma 14.7.1

Matrix products: default
BLAS:   /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] parallel  stats4    stats     graphics  grDevices utils     methods   base     

other attached packages:
 [1] spatialLIBD_1.18.0          BiocParallel_1.40.0        
 [3] parallelly_1.40.1           colorout_1.3-0.2           
 [5] WeberDivechaLCdata_1.8.0    ExperimentHub_2.14.0       
 [7] AnnotationHub_3.14.0        BiocFileCache_2.14.0       
 [9] dbplyr_2.5.0                SpatialExperiment_1.16.0   
[11] SingleCellExperiment_1.28.1 SummarizedExperiment_1.36.0
[13] Biobase_2.66.0              GenomicRanges_1.58.0       
[15] GenomeInfoDb_1.42.1         IRanges_2.40.1             
[17] S4Vectors_0.44.0            BiocGenerics_0.52.0        
[19] MatrixGenerics_1.18.0       matrixStats_1.4.1          
[21] gridExtra_2.3               ggtext_0.1.2               
[23] ggplot2_3.5.1               data.table_1.16.4          
[25] rlang_1.1.4                

loaded via a namespace (and not attached):
  [1] later_1.4.1               batchelor_1.22.0          BiocIO_1.16.0            
  [4] bitops_1.0-9              filelock_1.0.3            fields_16.3              
  [7] tibble_3.2.1              XML_3.99-0.17             lifecycle_1.0.4          
 [10] edgeR_4.4.1               doParallel_1.0.17         rprojroot_2.0.4          
 [13] lattice_0.22-6            magrittr_2.0.3            sass_0.4.9               
 [16] limma_3.62.1              plotly_4.10.4             rmarkdown_2.29           
 [19] jquerylib_0.1.4           yaml_2.3.10               httpuv_1.6.15            
 [22] spam_2.11-0               sessioninfo_1.2.2         cowplot_1.1.3            
 [25] DBI_1.2.3                 RColorBrewer_1.1-3        ResidualMatrix_1.16.0    
 [28] golem_0.5.1               maps_3.4.2.1              abind_1.4-8              
 [31] zlibbioc_1.52.0           purrr_1.0.2               RCurl_1.98-1.16          
 [34] rappdirs_0.3.3            GenomeInfoDbData_1.2.13   ggrepel_0.9.6            
 [37] irlba_2.3.5.1             DelayedMatrixStats_1.28.0 codetools_0.2-20         
 [40] DelayedArray_0.32.0       DT_0.33                   scuttle_1.16.0           
 [43] xml2_1.3.6                tidyselect_1.2.1          UCSC.utils_1.2.0         
 [46] viridis_0.6.5             ScaledMatrix_1.14.0       shinyWidgets_0.8.7       
 [49] GenomicAlignments_1.42.0  jsonlite_1.8.9            BiocNeighbors_2.0.1      
 [52] scater_1.34.0             iterators_1.0.14          foreach_1.5.2            
 [55] tools_4.4.1               Rcpp_1.0.13-1             glue_1.8.0               
 [58] SparseArray_1.6.0         xfun_0.49                 here_1.0.1               
 [61] dplyr_1.1.4               withr_3.0.2               BiocManager_1.30.25      
 [64] fastmap_1.2.0             fansi_1.0.6               digest_0.6.37            
 [67] rsvd_1.0.5                R6_2.5.1                  mime_0.12                
 [70] colorspace_2.1-1          RSQLite_2.3.9             config_0.3.2             
 [73] utf8_1.2.4                tidyr_1.3.1               generics_0.1.3           
 [76] rtracklayer_1.66.0        httr_1.4.7                htmlwidgets_1.6.4        
 [79] S4Arrays_1.6.0            pkgconfig_2.0.3           gtable_0.3.6             
 [82] blob_1.2.4                XVector_0.46.0            htmltools_0.5.8.1        
 [85] dotCall64_1.2             scales_1.3.0              png_0.1-8                
 [88] attempt_0.3.1             knitr_1.49                rstudioapi_0.17.1        
 [91] rjson_0.2.23              curl_6.0.1                cachem_1.1.0             
 [94] BiocVersion_3.20.0        vipor_0.4.7               AnnotationDbi_1.68.0     
 [97] restfulr_0.0.15           pillar_1.9.0              grid_4.4.1               
[100] vctrs_0.6.5               promises_1.3.2            BiocSingular_1.22.0      
[103] beachmat_2.22.0           xtable_1.8-4              beeswarm_0.4.0           
[106] paletteer_1.6.0           evaluate_1.0.1            magick_2.8.5             
[109] cli_3.6.3                 locfit_1.5-9.10           compiler_4.4.1           
[112] Rsamtools_2.22.0          crayon_1.5.3              rematch2_2.1.2           
[115] ggbeeswarm_0.7.2          viridisLite_0.4.2         munsell_0.5.1            
[118] Biostrings_2.74.0         lazyeval_0.2.2            Matrix_1.7-1             
[121] benchmarkme_1.0.8         sparseMatrixStats_1.18.0  bit64_4.5.2              
[124] KEGGREST_1.46.0           statmod_1.5.0             shiny_1.9.1              
[127] gridtext_0.1.5            igraph_2.1.2              memoise_2.0.1            
[130] bslib_0.8.0               benchmarkmeData_1.0.4     bit_4.5.0.1              
> sessioninfo::session_info()
─ Session info ──────────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.4.1 RC (2024-06-06 r86719)
 os       macOS Sonoma 14.7.1
 system   aarch64, darwin20
 ui       RStudio
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       America/Chicago
 date     2025-01-24
 rstudio  2024.07.0-daily+219 Cranberry Hibiscus (desktop)
 pandoc   3.1.11 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/aarch64/ (via rmarkdown)

─ Packages ──────────────────────────────────────────────────────────────────────
 ! package              * version   date (UTC) lib source
   abind                  1.4-8     2024-09-12 [1] CRAN (R 4.4.1)
   AnnotationDbi          1.68.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   AnnotationHub        * 3.14.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   attempt                0.3.1     2020-05-03 [1] CRAN (R 4.4.0)
   batchelor              1.22.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   beachmat               2.22.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   beeswarm               0.4.0     2021-06-01 [1] CRAN (R 4.4.0)
   benchmarkme            1.0.8     2022-06-12 [1] CRAN (R 4.4.0)
   benchmarkmeData        1.0.4     2020-04-23 [1] CRAN (R 4.4.0)
   Biobase              * 2.66.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   BiocFileCache        * 2.14.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   BiocGenerics         * 0.52.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   BiocIO                 1.16.0    2024-12-12 [1] Github (Bioconductor/BiocIO@8e80624)
   BiocManager            1.30.25   2024-08-28 [1] CRAN (R 4.4.1)
   BiocNeighbors          2.0.1     2024-11-28 [1] Bioconductor 3.20 (R 4.4.2)
   BiocParallel         * 1.40.0    2024-11-23 [1] Bioconductor 3.20 (R 4.4.2)
   BiocSingular           1.22.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   BiocVersion            3.20.0    2024-05-04 [1] Bioconductor 3.20 (R 4.4.0)
   Biostrings             2.74.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   bit                    4.5.0.1   2024-12-03 [1] CRAN (R 4.4.1)
   bit64                  4.5.2     2024-09-22 [1] CRAN (R 4.4.1)
   bitops                 1.0-9     2024-10-03 [1] CRAN (R 4.4.1)
   blob                   1.2.4     2023-03-17 [1] CRAN (R 4.4.0)
   bslib                  0.8.0     2024-07-29 [1] CRAN (R 4.4.0)
   cachem                 1.1.0     2024-05-16 [1] CRAN (R 4.4.0)
 P cli                    3.6.3     2024-06-21 [2] CRAN (R 4.4.0)
   codetools              0.2-20    2024-03-31 [1] CRAN (R 4.4.1)
   colorout             * 1.3-0.2   2024-05-01 [1] Github (jalvesaq/colorout@c6113a2)
   colorspace             2.1-1     2024-07-26 [1] CRAN (R 4.4.0)
   config                 0.3.2     2023-08-30 [1] CRAN (R 4.4.0)
   cowplot                1.1.3     2024-01-22 [1] CRAN (R 4.4.0)
   crayon                 1.5.3     2024-06-20 [1] CRAN (R 4.4.0)
   curl                   6.0.1     2024-11-14 [1] CRAN (R 4.4.1)
   data.table           * 1.16.4    2024-12-06 [1] CRAN (R 4.4.1)
   DBI                    1.2.3     2024-06-02 [1] CRAN (R 4.4.0)
   dbplyr               * 2.5.0     2024-03-19 [1] CRAN (R 4.4.0)
   DelayedArray           0.32.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   DelayedMatrixStats     1.28.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   digest                 0.6.37    2024-08-19 [1] CRAN (R 4.4.1)
   doParallel             1.0.17    2022-02-07 [1] CRAN (R 4.4.1)
   dotCall64              1.2       2024-10-04 [1] CRAN (R 4.4.1)
   dplyr                  1.1.4     2023-11-17 [1] CRAN (R 4.4.0)
   DT                     0.33      2024-04-04 [1] CRAN (R 4.4.0)
   edgeR                  4.4.1     2024-12-02 [1] Bioconductor 3.20 (R 4.4.2)
   evaluate               1.0.1     2024-10-10 [1] CRAN (R 4.4.1)
   ExperimentHub        * 2.14.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   fansi                  1.0.6     2023-12-08 [1] CRAN (R 4.4.0)
   fastmap                1.2.0     2024-05-15 [1] CRAN (R 4.4.0)
   fields                 16.3      2024-09-30 [1] CRAN (R 4.4.1)
   filelock               1.0.3     2023-12-11 [1] CRAN (R 4.4.0)
   foreach                1.5.2     2022-02-02 [1] CRAN (R 4.4.0)
   generics               0.1.3     2022-07-05 [1] CRAN (R 4.4.0)
   GenomeInfoDb         * 1.42.1    2024-11-28 [1] Bioconductor 3.20 (R 4.4.2)
   GenomeInfoDbData       1.2.13    2024-12-12 [1] Bioconductor
   GenomicAlignments      1.42.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   GenomicRanges        * 1.58.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   ggbeeswarm             0.7.2     2023-04-29 [1] CRAN (R 4.4.0)
   ggplot2              * 3.5.1     2024-04-23 [1] CRAN (R 4.4.0)
   ggrepel                0.9.6     2024-09-07 [1] CRAN (R 4.4.1)
   ggtext               * 0.1.2     2022-09-16 [1] CRAN (R 4.4.0)
   glue                   1.8.0     2024-09-30 [1] CRAN (R 4.4.1)
   golem                  0.5.1     2024-08-27 [1] CRAN (R 4.4.1)
   gridExtra            * 2.3       2017-09-09 [1] CRAN (R 4.4.0)
   gridtext               0.1.5     2022-09-16 [1] CRAN (R 4.4.0)
   gtable                 0.3.6     2024-10-25 [1] CRAN (R 4.4.1)
   here                   1.0.1     2020-12-13 [1] CRAN (R 4.4.0)
   htmltools              0.5.8.1   2024-04-04 [1] CRAN (R 4.4.0)
   htmlwidgets            1.6.4     2023-12-06 [1] CRAN (R 4.4.0)
   httpuv                 1.6.15    2024-03-26 [1] CRAN (R 4.4.0)
   httr                   1.4.7     2023-08-15 [1] CRAN (R 4.4.0)
   igraph                 2.1.2     2024-12-07 [1] CRAN (R 4.4.1)
   IRanges              * 2.40.1    2024-12-05 [1] Bioconductor 3.20 (R 4.4.2)
   irlba                  2.3.5.1   2022-10-03 [1] CRAN (R 4.4.0)
   iterators              1.0.14    2022-02-05 [1] CRAN (R 4.4.0)
   jquerylib              0.1.4     2021-04-26 [1] CRAN (R 4.4.0)
   jsonlite               1.8.9     2024-09-20 [1] CRAN (R 4.4.1)
   KEGGREST               1.46.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   knitr                  1.49      2024-11-08 [1] CRAN (R 4.4.1)
   later                  1.4.1     2024-11-27 [1] CRAN (R 4.4.1)
   lattice                0.22-6    2024-03-20 [1] CRAN (R 4.4.1)
   lazyeval               0.2.2     2019-03-15 [1] CRAN (R 4.4.0)
   lifecycle              1.0.4     2023-11-07 [1] CRAN (R 4.4.0)
   limma                  3.62.1    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   locfit                 1.5-9.10  2024-06-24 [1] CRAN (R 4.4.0)
   magick                 2.8.5     2024-09-20 [1] CRAN (R 4.4.1)
   magrittr               2.0.3     2022-03-30 [1] CRAN (R 4.4.0)
   maps                   3.4.2.1   2024-11-10 [1] CRAN (R 4.4.1)
   Matrix                 1.7-1     2024-10-18 [1] CRAN (R 4.4.1)
   MatrixGenerics       * 1.18.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   matrixStats          * 1.4.1     2024-09-08 [1] CRAN (R 4.4.1)
   memoise                2.0.1     2021-11-26 [1] CRAN (R 4.4.0)
   mime                   0.12      2021-09-28 [1] CRAN (R 4.4.0)
   munsell                0.5.1     2024-04-01 [1] CRAN (R 4.4.0)
   paletteer              1.6.0     2024-01-21 [1] CRAN (R 4.4.0)
   parallelly           * 1.40.1    2024-12-04 [1] CRAN (R 4.4.1)
   pillar                 1.9.0     2023-03-22 [1] CRAN (R 4.4.0)
   pkgconfig              2.0.3     2019-09-22 [1] CRAN (R 4.4.0)
   plotly                 4.10.4    2024-01-13 [1] CRAN (R 4.4.0)
   png                    0.1-8     2022-11-29 [1] CRAN (R 4.4.0)
   promises               1.3.2     2024-11-28 [1] CRAN (R 4.4.1)
   purrr                  1.0.2     2023-08-10 [1] CRAN (R 4.4.0)
   R6                     2.5.1     2021-08-19 [1] CRAN (R 4.4.0)
   rappdirs               0.3.3     2021-01-31 [1] CRAN (R 4.4.0)
   RColorBrewer           1.1-3     2022-04-03 [1] CRAN (R 4.4.0)
   Rcpp                   1.0.13-1  2024-11-02 [1] CRAN (R 4.4.1)
   RCurl                  1.98-1.16 2024-07-11 [1] CRAN (R 4.4.0)
   rematch2               2.1.2     2020-05-01 [1] CRAN (R 4.4.0)
   ResidualMatrix         1.16.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   restfulr               0.0.15    2022-06-16 [1] CRAN (R 4.4.0)
   rjson                  0.2.23    2024-09-16 [1] CRAN (R 4.4.1)
 P rlang                * 1.1.4     2024-06-04 [2] CRAN (R 4.4.1)
   rmarkdown              2.29      2024-11-04 [1] CRAN (R 4.4.1)
   rprojroot              2.0.4     2023-11-05 [1] CRAN (R 4.4.0)
   Rsamtools              2.22.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   RSQLite                2.3.9     2024-12-03 [1] CRAN (R 4.4.1)
   rstudioapi             0.17.1    2024-10-22 [1] CRAN (R 4.4.1)
   rsvd                   1.0.5     2021-04-16 [1] CRAN (R 4.4.0)
   rtracklayer            1.66.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   S4Arrays               1.6.0     2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   S4Vectors            * 0.44.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   sass                   0.4.9     2024-03-15 [1] CRAN (R 4.4.0)
   ScaledMatrix           1.14.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   scales                 1.3.0     2023-11-28 [1] CRAN (R 4.4.0)
   scater                 1.34.0    2024-10-29 [1] Bioconductor 3.20 (R 4.4.1)
   scuttle                1.16.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   sessioninfo            1.2.2     2021-12-06 [1] CRAN (R 4.4.0)
   shiny                  1.9.1     2024-08-01 [1] CRAN (R 4.4.0)
   shinyWidgets           0.8.7     2024-09-23 [1] CRAN (R 4.4.1)
   SingleCellExperiment * 1.28.1    2024-11-23 [1] Bioconductor 3.20 (R 4.4.2)
   spam                   2.11-0    2024-10-03 [1] CRAN (R 4.4.1)
   SparseArray            1.6.0     2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   sparseMatrixStats      1.18.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   SpatialExperiment    * 1.16.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   spatialLIBD          * 1.18.0    2024-11-07 [1] Bioconductor 3.20 (R 4.4.1)
   statmod                1.5.0     2023-01-06 [1] CRAN (R 4.4.0)
   SummarizedExperiment * 1.36.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   tibble                 3.2.1     2023-03-20 [1] CRAN (R 4.4.0)
   tidyr                  1.3.1     2024-01-24 [1] CRAN (R 4.4.0)
   tidyselect             1.2.1     2024-03-11 [1] CRAN (R 4.4.0)
   UCSC.utils             1.2.0     2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   utf8                   1.2.4     2023-10-22 [1] CRAN (R 4.4.0)
   vctrs                  0.6.5     2023-12-01 [1] CRAN (R 4.4.0)
   vipor                  0.4.7     2023-12-18 [1] CRAN (R 4.4.0)
   viridis                0.6.5     2024-01-29 [1] CRAN (R 4.4.0)
   viridisLite            0.4.2     2023-05-02 [1] CRAN (R 4.4.0)
   WeberDivechaLCdata   * 1.8.0     2024-10-31 [1] Bioconductor 3.20 (R 4.4.1)
   withr                  3.0.2     2024-10-28 [1] CRAN (R 4.4.1)
   xfun                   0.49      2024-10-31 [1] CRAN (R 4.4.1)
   XML                    3.99-0.17 2024-06-25 [1] CRAN (R 4.3.3)
   xml2                   1.3.6     2023-12-04 [1] CRAN (R 4.4.0)
   xtable                 1.8-4     2019-04-21 [1] CRAN (R 4.4.0)
   XVector                0.46.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   yaml                   2.3.10    2024-07-26 [1] CRAN (R 4.4.0)
   zlibbioc               1.52.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)

 [1] /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library
 [2] /Users/bmulvey/Library/R/arm64/4.4/library

 P ── Loaded and on-disk path mismatch.

─────────────────────────────────────────────────────────────────────────────────
