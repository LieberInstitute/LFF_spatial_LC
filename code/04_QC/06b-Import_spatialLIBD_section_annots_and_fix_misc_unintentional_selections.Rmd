---
title: "06b-Import spatialLIBD section annots and fix misc unintentional selections"
output: html_document
date: "2024-08-17"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.height = 10,fig.width = 7,include = FALSE)
#### sets tab autocompletion for directories to begin from the directory containing the .Rproj session, instead of the script's directory if different
knitr::opts_knit$set(root.dir = here::here())

library(data.table)
library(ggplot2)
library(gridExtra)
library(SpatialExperiment)
library(SpatialFeatureExperiment)
library(spatialLIBD)

## rstudio GUI tweaks
require(colorout)
ColorOut()
options("styler.addins_style_transformer" = "biocthis::bioc_style()")
##

## enable forked parallel processing with BiocParallel::multicoreParam, future::, etc. seemed to need this a couple times, but otherwise havent so its here as a preventative measure. part of this is adding the line 
# OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES
# to Renviron.site. see e.g. top response on https://stackoverflow.com/questions/73638290/python-on-mac-is-it-safe-to-set-objc-disable-initialize-fork-safety-yes-globall 
library(parallelly)
options(parallelly.supportsMulticore.disableOn="")
options(parallelly.fork.enable=TRUE)
library(BiocParallel)
options(bphost="localhost")


## ggplot defaults
theme_set(theme_bw()+theme(axis.text.x = element_text(size = 14), axis.title.x = element_text(size = 16), axis.text.y = element_text(size = 14), axis.title.y = element_text(size =16), plot.title = element_text(size = 20,hjust=0.5), strip.text = element_text(size=18), legend.text = element_text(size=10), legend.title = element_text(size=11,hjust=0.5)))

## last of all, unload the base package datasets, whose data keep getting in the way of autocompletions (e.g., Theoph is priortized over TRUE)
unloadNamespace("datasets")
```

## for the following samples, an interactive spatialLIBD web browser section was used to manually annotate spots overlapping one tissue section for each of the following capture areas:
	1. 284_D1
	2. 286_B1
	3. 332_A1
	4. 332_C1
	5. 333_A1
	6. 402_A1
	7. 404_B1
	8. 404_C1
	9. 404_D1
	
BUT, the ability to bulk select spots is imperfect and a few of these ended up with e.g. a column of spots included that are in the other tissue section, etc. The following need cleanup, or at least checking for cleanup to add single spots or remove unintended spots selected in the annotation process:
332_C1
402_A1
404_D1

```{r}
## read in the imperfect outputs
imperfectsearch <- list.files("processed-data/04_QC/06b-Uncleaned_capture_area_sectionsplitting_spatialLIBD_outputs",full.names = TRUE)
imperfect <- grep(imperfectsearch,pattern="^.*outputs/.*remov.*$",value=T)
imperfect <- grep(imperfect,pattern="^.*\\.txt|\\.csv.*$",value=T)
rm(imperfectsearch)

imperfects <- lapply(imperfect,fread)
imperfects <- rbindlist(imperfects)

## change the output sample_ids to match the format in the SPE (instead of -A1,-B1 etc, make them _A1..)
imperfects[,sample_id:=gsub(sample_id,pattern="^(.*)-(..)$",replacement=paste0("\\1","_","\\2"))]

## construct the equivalent of the spe's coldata "key" field to map these as labels.
imperfects[,key:=paste0(spot_name,"_",sample_id)]

## the single section selected on 333_A1 was given a different name for the section annotation so fix  that to be section_1 for consistency with 06a and the others here
```


## now we'll adapt what we did previously for manual, array_row-array_col-based splitting in the previous script: here, we'll do the same, plotting all spots (not just "in_tissue" spots, since the internal spatiallibd browser used the raw spe, so it'll be easier to visually see what's what using all spots here), then plotting with colorization by spatialLIBD annotated section. doing that, we can identify e.g. stray or missing spots based on the annotated .png files found in processed-data/06b-Uncleaned...
```{r}
lc <- readRDS("processed-data/02_build_spe/spe_raw.rds")
# make colnames of the spe completely unique (using the coldata()$key field)
colnames(lc) <- colData(lc)$key

tmpcd <- as.data.table(colData(lc))
tmpcd <- split(tmpcd,tmpcd$sample_id)
tmpcd <- tmpcd[names(tmpcd) %in% c("V13M06-332_C1","V13M06-402_A1","V13M06-404_D1")]

### first, do a bit more preprocessing with the imperfects: get the rest of the spots' key values (we only annotated one section for each capture area (as "section_1"), so i.e. all spots not labeled in the imperfects will be part of the other section.) 
### then just make a series of stupidsimple x-y plots
plt <- mapply(
    tmpcd,names(tmpcd),SIMPLIFY = FALSE,
    FUN = function(x,y) {
        ## subset the spatiallibd splits to current sample
        z <- imperfects[sample_id==y,.(sample_id,key,ManualAnnotation)]

        ## get other spots not in the annotation, label them as other section, add array_col and array_row info for all spots, and plot colored by this label
        addnl <- x[!key %in% z$key,.(sample_id,key)]
        addnl[,ManualAnnotation:="section_2"]
        z <- rbind(z,addnl)
        z <- merge(z,x[,.(key,array_col,array_row)],by="key")

        p <- ggplot(z,aes(x=array_col,y=array_row,col=ManualAnnotation))+
            geom_point(size=0.4)+
            theme_minimal()+
            ggtitle(y)+
            geom_hline(yintercept = seq(0.25,(max(lc$array_row)+.25),5),colour="green",linewidth = 0.6)+
            geom_vline(xintercept = seq(0.25,(max(lc$array_col)+.25),5),colour = "green",linewidth = 0.6)
        retlist <- list(p,z)
        return(retlist)
    }
)

plts <- lapply(plt,FUN=function(x){x[[1]]})
fullsectionannot <- lapply(plt,FUN=function(x){x[[2]]})

pdf("~/Desktop/LCsplits_to_fix.pdf",width=18,height=18) 
do.call("grid.arrange",plts)
dev.off()
```

## 332_C1: should be section_2: (array_row<=20&array_row>=15 & array_col %in% c(83,82)) | (array_row==22 & array_col==82) are not supposed to be part of this section, nor are array_row>=25 & array_row<=28 & array_col %in% c(78,79)

### 402_A1: array_row>25 & array_row<30 & array_col %in% c(74,75) SHOULD be section_1, array_row==32 & array_col==78 should be section_2, and everything at array_row>35 and array_col>70 should be section_2.

### 404_D1: array_row %in% c(25,26) & array_col>70 should be section_2, and array_row==24 & array_col==73 should be section_1.

```{r}
fixedannots <- rbindlist(fullsectionannot)

## 332_C1
fixedannots[sample_id=="V13M06-332_C1" & (
                (array_row<=20&array_row>=15 & array_col %in% c(83,82)) | 
                (array_row==22 & array_col==82) |
                (array_row>=25&array_row<=28 & array_col %in% c(78,79))),
            ManualAnnotation:="section_2"]

## 402_A1
fixedannots[sample_id=="V13M06-402_A1" & (
            (array_row==32 & array_col==78) |
            (array_row>35 & array_col>70)),
        ManualAnnotation:="section_2"]

fixedannots[sample_id=="V13M06-402_A1" & 
                array_row>25 & array_row<30 & array_col %in% c(74,75),
            ManualAnnotation:="section_1"]

## 404_D1
fixedannots[sample_id=="V13M06-404_D1" &
            array_row %in% c(25,26) & array_col>70,
        ManualAnnotation:="section_2"]

fixedannots[sample_id=="V13M06-404_D1" &
                array_row==29 & array_col==73,
            ManualAnnotation:="section_1"]


### now plotcheck these.
fixedannotsplt <- split(fixedannots,fixedannots$sample_id)
plt <- mapply(
    fixedannotsplt,names(fixedannotsplt),SIMPLIFY = FALSE,
    FUN = function(x,y) {
        p <- ggplot(x,aes(x=array_col,y=array_row,col=ManualAnnotation))+
            geom_point(size=0.4)+
            theme_minimal()+
            ggtitle(y)+
            geom_hline(yintercept = seq(0.25,(max(lc$array_row)+.25),5),colour="green",linewidth = 0.6)+
            geom_vline(xintercept = seq(0.25,(max(lc$array_col)+.25),5),colour = "green",linewidth = 0.6)
        return(p)
    }
)

pdf("~/Desktop/fixcheck.pdf",height=18,width=18)
do.call("grid.arrange",plt)
dev.off()
```

332_C1: looks good.
402_A1: row 31, col 77 should be section_2
404_D1: looks good.

### fix 402_A1
```{r}
fixedannots[sample_id=="V13M06-402_A1" &
            array_row==31 & array_col==77,
        ManualAnnotation:="section_2"]
```

### now load the other spatialLIBD section annotations and check all of them, including the imperfects
```{r}
checkanno <- list.files("processed-data/04_QC/06b-Uncleaned_capture_area_sectionsplitting_spatialLIBD_outputs",full.names = TRUE)
checkanno <- grep(checkanno,pattern="^.*outputs/.*remov.*$",value=T,invert=T)
checkanno <- grep(checkanno,pattern="^.*\\.txt|\\.csv.*$",value=T)

checkannos <- lapply(checkanno,fread)
checkannos <- rbindlist(checkannos)

## change the output sample_ids to match the format in the SPE (instead of -A1,-B1 etc, make them _A1..)
checkannos[,sample_id:=gsub(sample_id,pattern="^(.*)-(..)$",replacement=paste0("\\1","_","\\2"))]

## construct the equivalent of the spe's coldata "key" field to map these as labels.
checkannos[,key:=paste0(spot_name,"_",sample_id)]

## add array row and col for plotting
checkannos <- merge(checkannos,as.data.table(colData(lc))[,.(key,array_col,array_row)],by="key")
checkannos[,spot_name:=NULL]

# order columns the same in checkannos
names(fixedannots)
checkannos <- checkannos[,.(key,sample_id,ManualAnnotation,array_col,array_row)]
## merfixedannots## merge the fixedannotNULL## merge the fixedannots with the checkannos
allannots <- rbind(fixedannots,checkannos[,])

## make tissueless plot series to check for missing single spots etc. include fewer horiz/vert lines so theres less clutter for this check
allannotsplt <- split(allannots,allannots$sample_id)

## for the ones we're chekcing for the first time here, we need to pull in the other spots and label as the other section.
plt <- mapply(
    allannotsplt,names(allannotsplt),SIMPLIFY = FALSE,
    FUN = function(x,y) {
        
        z <- as.data.table(colData(lc))[sample_id==y,.(key,sample_id,ManualAnnotation,array_col,array_row)]
        z <- z[!key %in% x$key,]
        z[,ManualAnnotation:="section_2"]
        z <- rbind(x,z)
        
        p <- ggplot(z,aes(x=array_col,y=array_row,col=ManualAnnotation))+
            geom_point(size=0.4)+
            theme_minimal()+
            ggtitle(y)+
            geom_hline(yintercept = seq(0.25,(max(lc$array_row)+.25),20),colour="green",linewidth = 0.6)+
            geom_vline(xintercept = seq(0.25,(max(lc$array_col)+.25),20),colour = "green",linewidth = 0.6)
        retlist <- list(p,z)
        return(retlist)
    }
)

plts <- lapply(plt,FUN=function(x){x[[1]]})
allsectionannot <- lapply(plt,FUN=function(x){x[[2]]})

pdf("~/Desktop/check_allslibdannots_notiss.pdf",height=27,width=27)
do.call("grid.arrange",plts)
dev.off()

rm(plt,plts)
```

### some spots in edge rows/cols look like they escaped annotation in several samples here:
402_A1: array_row==0 & array_col>20 & array_col<60
332_A1: array_col==max(array_col) (not sure what row range without tissue overlaid).
404_C1: array_row==0 and array_col %in% c((max(array_col)-3):max(array_col))

before we fix this let's plot all of the slibd annotations overlaid on tissue and check that they look correct otherwise.
```{r}
allsectionannots <- rbindlist(allsectionannot)

## subset spe for plotting
checkspe <- lc[,lc$sample_id %in% unique(allsectionannots$sample_id)]

### assign labels
allsectionannots2 <- DataFrame(allsectionannots,row.names=allsectionannots$key)[colnames(checkspe),]
colLabels(checkspe) <- allsectionannots2$ManualAnnotation

plt <- spatialLIBD::vis_grid_clus(checkspe,clustervar="label",return_plots = T,spatial=T,image_id="hires",alpha=0.45,auto_crop = T)

pdf("~/Desktop/check_slibdannots_tissue_coplotted.pdf",height=28,width=28)
do.call("grid.arrange",plt)
dev.off()


```

332_A1, 332_C1, 333_A1, 404_B1, 404_C1, 404_D1, and 402_A1 need some minor fixes and a few point assignments that are more safeguards just in case loupe decided something was "in tissue" that doesn't necessarily look like it. (the spots we plot are not necessarily accurate to the pixel, so good to have a buffer zone where possible.)

(note that the plots marked up and coordinates determined from this using the plot below (with the markup visually cross-annotated onto the set of plots in the next block) are in 
here::here() / processed-data/06b_final_round-of-split-preening_plotscreenshots_markedup/  
)

so make a densely x-y-gridded plot for these so we can get the row-col pairs that need changing by visually cross-referencing with the + tissue plots we put out above. also, clean up the workspace so we don't hang onto pre-corrected versions of stuff by accident.
```{r}
rm(imperfects,plt,tmpcd,allsectionannots2,checkannos,fixedannots,fixedannotsplt,checkanno,imperfect,allannots,allannotsplt,fullsectionannot,allsectionannot)

### grid plotting for final round of fixes
finalfixgridpltdat <- split(allsectionannots,allsectionannots$sample_id)
finalfixgridpltdat <- finalfixgridpltdat[!(names(finalfixgridpltdat) %in% c("V13B23-284_D1","V13B23-286_B1"))]

plt <- mapply(
    finalfixgridpltdat,names(finalfixgridpltdat),SIMPLIFY = FALSE,
    FUN = function(x,y) {
        p <- ggplot(x,aes(x=array_col,y=array_row,col=ManualAnnotation))+
            geom_point(size=0.4)+
            theme_minimal()+
            ggtitle(y)+
            geom_hline(yintercept = seq(0.25,(max(lc$array_row)+.25),5),colour="green",linewidth = 0.6)+
            geom_vline(xintercept = seq(0.25,(max(lc$array_col)+.25),5),colour = "green",linewidth = 0.6)
        return(p)
    }
)

pdf("~/Desktop/finalfixgridplots.pdf",height=18,width=18)
do.call("grid.arrange",c(plt,ncol=3))
dev.off()

```

okay many fixes here we go
332_A1: array_col>120&array_row>=0: section 1
	one spot labeled "your guess": section 2
	array_col %in% c(114:118) & array_row %in% c(16:20): section_1
	array_col %in% c(94:101) & array_row>=75: section_1
	array_col==93 & array_row==75: section_1
	array_col==90 & array_row==74: section_1
	array_col==87 & array_row==73: section_1
	array_col==86 & array_row==72: section_1
	array_col==84 & array_row==71: section_1
	array_col==80 & array_row==21: section_1
	array_col== & array_row==
	array_col==69 & array_row %in% c(35:41): section_1
	array_col==68 & array_row==36: section 1
	array_col==57 & array_row==45: section 1
	array_col==56 & array_row==44: section 1

332_C1
	array_col==113 & array_row==73: section 1
	array_col %in% c(81:85) & array_row==71: section 1
	array_col==80 & array_row %in% c(52,68,70): section 1
	array_col==78 & array_row %in% c(36,38): section 1
	array_col==115 & array_row==21: section 1

333_A1
	array_col==52 & array_row==16: section 1
	array_col==51 & array_row %in% c(21,23): section 1
	array_col==50 & array_row==38: section 1
	array_col==52 & array_row==50: section_1

402_A1
	array_col<60 & array_row==0: section_1
	array_col==77 & array_row=29: section_2
	array_col==76 & array_row==30 section_2
	array_col==78 & array_row==34 section_1
	array_col==51 & array_row==55 section 1
	array_col==50 & array_row==56 section 1
	array_col==49 & array_row==57 section 1
	array_col %in% c(34,36) & array_row==60 section 1
	array_col %in% c(33,35) & array_row==61 section 1
	array_col %in5 c(22,24,26,28) & array_row==62 section 1
	array_col %in5 c(17,19,21,25,27) & array_row==63 section 1
	array_col %in% c(14,16,18,20,22) & array_row==64 section 1

404_B1 120 done 119 done 118 done 117 done 116 done
	array_col==66 & array_row>=14 & array_row<=50: section 1
	array_col==67 & array_row==13 section 1
	array_col==68 & array_row %in% c(49,51) section 1	
	array_col==59 & array_row==15 section 1
	array_col==55 & array_row==5 section 1
	array_col==54 & array_row==6 section 1
	array_col==56 & array_row==4 section 1
	array_col==101 & array_row==5 sectoin 1
	array_col==109 & array_row==7 section 1
	array_col==118 & array_row==20 section 1
	array_col==119 & array_row==21 section 1
	array_col==120 & array_row==30 section 1
	array_col==121 & array_row==31 section 1
	array_col==122 & array_row==32 section 1
	array_col==123 & array_row==33 section 1
	array_col==124 & array_row==34 section 1
	array_col==120 & array_row==32 section 1
	array_col==121 & array_row==33 section 1
	array_col==122 & array_row==34 section 1
	array_col==123 & array_row==35 section 1
	array_col==120 & array_row %in% c(38,40) section 1
	array_col==119 & array_row %in% c(37,39,41,53) section 1
	array_col==118 & array_row %in% c(42,48,50,52,54) section 1
	array_col==117 & array_row %in% c(43,47,49,51,55) section 1
	array_col==116 & array_row %in% c(44,46,50,56) section 1
	array_col==115 & array_row %in% c(55,57,63) section 1
	array_col==114 & array_row %in% c(56,58) section 1
	array_col==105 & array_row==69 section 1
	array_col==104 & array_row==70 section 1
	
404_C1
	array_row %in% c(0,1) & array_col>120 sectoin 1
	array_col==61 & array_row %in% c(1,3,5,7,9,11,13,15) section 1
	array_col==60 & array_row %in c(8,10) section 1
	array_col==64 & array_row==18 section 1
	array_col==65 & array_row %in% c(17,19) section 1
	array_ col %in% c(48,66) & array_row==20 section 1
	array_ col==66 & array_row==40 section 1	
	array_ col==61 & & array_row  %in% c(53,55,57) section 1
	array_col %in% c(53,57) & array_row==43 section 1
	array_col==58 & array_row==44 section 1
	array_col>125 & array_row<10 section 1
	array_col==110 & array_row==40 section 1
	array_col==114 & array_row==64 section 1
	array_col==113 & array_row==65 section 1
	array_col==112 & array_row==66 section 1
	array_col==111 & array_row==67 section 1
	array_col==110 & array_row==68 section 1

404_D1
	array_col==48 & array_row==54 section 1
	array_col==63 & array_row==49 section 1
	array_col==73 & array_row==29 section 2
	
```{r}
allsectionannots[sample_id=="V13M06-332_A1" & array_col>120 & array_row>=0,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_A1"&ManualAnnotation=="Your Guess",ManualAnnotation:="section_2"]
allsectionannots[sample_id=="V13M06-332_A1" & array_col %in% c(114:118) & array_row %in% c(16:20),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_A1" & array_col %in% c(94:101) & array_row>=75,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_A1" & array_col==93 & array_row==75,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_A1" & array_col==90 & array_row==74,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_A1" & array_col==87 & array_row==73,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_A1" & array_col==86 & array_row==72,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_A1" & array_col==84 & array_row==71,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_A1" & array_col==80 & array_row==21,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_A1" & array_col==69 & array_row %in% c(35:41),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_A1" & array_col==68 & array_row==36,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_A1" & array_col==57 & array_row==45,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_A1" & array_col==56 & array_row==44,ManualAnnotation:="section_1"]

### 332_C1
allsectionannots[sample_id=="V13M06-332_C1" & array_col==113 & array_row==73,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_C1" & array_col %in% c(81:85) & array_row==71,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_C1" & array_col==80 & array_row %in% c(52,68,70),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_C1" & array_col==78 & array_row %in% c(36,38),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-332_C1" & array_col==115 & array_row==21,ManualAnnotation:="section_1"]

### 333_A1
allsectionannots[sample_id=="V13M06-333_A1" & array_col==52 & array_row==16,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-333_A1" & array_col==51 & array_row %in% c(21,23),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-333_A1" & array_col==50 & array_row==38,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-333_A1" & array_col==52 & array_row==50,ManualAnnotation:="section_1"]

### 402_A1
allsectionannots[sample_id=="V13M06-402_A1" & array_col<60 & array_row==0,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-402_A1" & array_col==77 & array_row==29,ManualAnnotation:="section_2"]
allsectionannots[sample_id=="V13M06-402_A1" & array_col==76 & array_row==30,ManualAnnotation:="section_2"]
allsectionannots[sample_id=="V13M06-402_A1" & array_col==78 & array_row==34,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-402_A1" & array_col==51 & array_row==55,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-402_A1" & array_col==50 & array_row==56,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-402_A1" & array_col==49 & array_row==57,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-402_A1" & array_col %in% c(34,36) & array_row==60,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-402_A1" & array_col %in% c(33,35) & array_row==61,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-402_A1" & array_col %in% c(22,24,26,28) & array_row==62,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-402_A1" & array_col %in% c(17,19,21,25,27) & array_row==63,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-402_A1" & array_col %in% c(14,16,18,20,22) & array_row==64,ManualAnnotation:="section_1"]

### 404_B1
allsectionannots[sample_id=="V13M06-404_B1" & array_col==66 & array_row>=14 & array_row<=50,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==67 & array_row==13,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==68 & array_row %in% c(49,51),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==59 & array_row==15,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==55 & array_row==5,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==54 & array_row==6,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==56 & array_row==4,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==101 & array_row==5,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==109 & array_row==7,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==118 & array_row==20,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==119 & array_row==21,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==120 & array_row==30,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==121 & array_row==31,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==122 & array_row==32,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==123 & array_row==33,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==124 & array_row==34,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==120 & array_row==32,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==121 & array_row==33,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==122 & array_row==34,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==123 & array_row==35,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==120 & array_row %in% c(38,40),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==119 & array_row %in% c(37,39,41,53),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==118 & array_row %in% c(42,48,50,52,54),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==117 & array_row %in% c(43,47,49,51,55),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==116 & array_row %in% c(44,46,50,56),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==115 & array_row %in% c(55,57,63),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==114 & array_row %in% c(56,58),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==105 & array_row==69,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_B1" & array_col==104 & array_row==70,ManualAnnotation:="section_1"]

### 404_C1
allsectionannots[sample_id=="V13M06-404_C1" & array_row %in% c(0,1) & array_col>120,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col==61 & array_row %in% c(1,3,5,7,9,11,13,15),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col==60 & array_row %in% c(8,10),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col==64 & array_row==18,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col==65 & array_row %in% c(17,19),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col %in% c(48,66) & array_row==20,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col==66 & array_row==40,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col==61 & array_row %in% c(53,55,57),ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col %in% c(53,57) & array_row==43,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col==58 & array_row==44,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col>125 & array_row<10,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col==110 & array_row==40,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col==114 & array_row==64,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col==113 & array_row==65,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col==112 & array_row==66,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col==111 & array_row==67,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_C1" & array_col==110 & array_row==68,ManualAnnotation:="section_1"]

### 404_D1
allsectionannots[sample_id=="V13M06-404_D1" & array_col==48 & array_row==54,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_D1" & array_col==63 & array_row==49,ManualAnnotation:="section_1"]
allsectionannots[sample_id=="V13M06-404_D1" & array_col==73 & array_row==29,ManualAnnotation:="section_2"]
```


### WE DID IT THANK GITHUB COPILOT
### now attach all of the previous simple linear-geometry extracted annotations and save as one bigol table
```{r}
simplesplits <- fread("/Users/bmulvey/Desktop/KM Lab/local_lffLC/LFF_spatial_LC/processed-data/04_QC/06a-capture_areas_split_withOUT_slibd.txt")

# names(simplesplits)
# subset to the same columns we have in allsectionannots 
simplesplits <- simplesplits[,.(key,sample_id,section,array_col,array_row)]

# unique(simplesplits$section)
# this table includes all possible spots including those not previously annotated, so drop those first
simplesplits <- simplesplits[section!="noneassigned"]

stopifnot(nrow(simplesplits[sample_id %in% allsectionannots$sample_id])==0)
stopifnot(length(unique(simplesplits$sample_id))+length(unique(allsectionannots$sample_id))==length(unique(lc$sample_id)))
stopifnot(nrow(simplesplits[key %in% allsectionannots$key])!=0 | nrow(allsectionannots[key %in% simplesplits$key])!=0)

# the annotation field is named "section" in the simple splits table, so rename in our allsection annots table to match
setnames(allsectionannots,"ManualAnnotation","section")

### join em!
allfinalsectionsplits <- rbind(allsectionannots,simplesplits)

## last checks: make sure there are no spots in the spe unaccounted for; make sure there are no duplicate entries in the above table; make sure there are no labels besides sectoin_1 and section_2
stopifnot(sum(lc$key %in% unique(allfinalsectionsplits$key))==length(unique(lc$key)))
stopifnot(nrow(allfinalsectionsplits[,.N,by="key"][N>1])==0)
stopifnot(length(unique(allfinalsectionsplits$section))==2)

## wow actually checks out. save it.
fwrite(allfinalsectionsplits,"processed-data/04_QC/06c-raw_SPE_spots_assigned_to_tissue-section-1or2_for_all_capture_areas.txt",sep='\t',quote=F)

## clean up
rm(plt,simplesplits,finalfixgridpltdat,checkspe,allsectionannots)
```

### fiii nuh ly, get the pixel col in fullres and pixel row in fullres for all spots marked "overlaps tissue" for Maddy T to split and process the images accordingly for neuromelanin.
```{r}
lcintiss <- lc[,lc$overlaps_tissue=="in"]

fullres_with_splitannots <- as.data.table(cbind(colData(lcintiss)[,c("key","sample_id","array_row","array_col")],lcintiss@int_colData$spatialCoords))

fullres_with_splitannots <- merge.data.table(fullres_with_splitannots,allfinalsectionsplits[,.(key,section)],by="key")

fullres_with_splitannots <- fullres_with_splitannots[,.(sample_id,section,pxl_col_in_fullres,pxl_row_in_fullres)]

fwrite(fullres_with_splitannots,"processed-data/04_QC/06c-tissueOverlapping_spots_with_fullres-pixel-row-col-coords_and_section_annotations.txt",sep='\t',quote=F)
```


reproducibility info
```{r}
sessionInfo()
sessioninfo::session_info()
```

R version 4.4.1 RC (2024-06-06 r86719)
Platform: aarch64-apple-darwin20
Running under: macOS Sonoma 14.5

Matrix products: default
BLAS:   /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] stats4    stats     graphics  grDevices utils     methods   base     

other attached packages:
 [1] BiocParallel_1.38.0            parallelly_1.38.0             
 [3] colorout_1.3-0.2               spatialLIBD_1.16.2            
 [5] SpatialFeatureExperiment_1.6.1 SpatialExperiment_1.14.0      
 [7] SingleCellExperiment_1.26.0    SummarizedExperiment_1.34.0   
 [9] Biobase_2.64.0                 GenomicRanges_1.56.1          
[11] GenomeInfoDb_1.40.1            IRanges_2.38.1                
[13] S4Vectors_0.42.1               BiocGenerics_0.50.0           
[15] MatrixGenerics_1.16.0          matrixStats_1.3.0             
[17] gridExtra_2.3                  ggplot2_3.5.1                 
[19] data.table_1.15.4              rlang_1.1.4                   

loaded via a namespace (and not attached):
  [1] later_1.3.2               BiocIO_1.14.0             bitops_1.0-7             
  [4] filelock_1.0.3            fields_16.2               tibble_3.2.1             
  [7] R.oo_1.26.0               XML_3.99-0.17             lifecycle_1.0.4          
 [10] sf_1.0-16                 edgeR_4.2.0               doParallel_1.0.17        
 [13] rprojroot_2.0.4           lattice_0.22-6            magrittr_2.0.3           
 [16] rmarkdown_2.27            sass_0.4.9                limma_3.60.3             
 [19] plotly_4.10.4             jquerylib_0.1.4           yaml_2.3.9               
 [22] httpuv_1.6.15             spam_2.10-0               sessioninfo_1.2.2        
 [25] sp_2.1-4                  cowplot_1.1.3             DBI_1.2.3                
 [28] RColorBrewer_1.1-3        golem_0.4.1               maps_3.4.2               
 [31] abind_1.4-5               zlibbioc_1.50.0           purrr_1.0.2              
 [34] R.utils_2.12.3            RCurl_1.98-1.14           rappdirs_0.3.3           
 [37] GenomeInfoDbData_1.2.12   ggrepel_0.9.5             irlba_2.3.5.1            
 [40] terra_1.7-78              units_0.8-5               dqrng_0.4.1              
 [43] DelayedMatrixStats_1.26.0 codetools_0.2-20          DropletUtils_1.24.0      
 [46] DelayedArray_0.30.1       DT_0.33                   scuttle_1.14.0           
 [49] tidyselect_1.2.1          farver_2.1.2              UCSC.utils_1.0.0         
 [52] viridis_0.6.5             ScaledMatrix_1.12.0       shinyWidgets_0.8.6       
 [55] BiocFileCache_2.12.0      GenomicAlignments_1.40.0  jsonlite_1.8.8           
 [58] BiocNeighbors_1.22.0      e1071_1.7-14              scater_1.32.0            
 [61] iterators_1.0.14          foreach_1.5.2             tools_4.4.1              
 [64] Rcpp_1.0.13               glue_1.7.0                SparseArray_1.4.8        
 [67] xfun_0.45                 here_1.0.1                EBImage_4.46.0           
 [70] dplyr_1.1.4               HDF5Array_1.32.0          withr_3.0.0              
 [73] BiocManager_1.30.23       fastmap_1.2.0             boot_1.3-30              
 [76] rhdf5filters_1.16.0       fansi_1.0.6               spData_2.3.1             
 [79] rsvd_1.0.5                digest_0.6.36             R6_2.5.1                 
 [82] mime_0.12                 colorspace_2.1-0          wk_0.9.2                 
 [85] jpeg_0.1-10               RSQLite_2.3.7             R.methodsS3_1.8.2        
 [88] config_0.3.2              utf8_1.2.4                tidyr_1.3.1              
 [91] generics_0.1.3            rtracklayer_1.64.0        class_7.3-22             
 [94] httr_1.4.7                htmlwidgets_1.6.4         S4Arrays_1.4.1           
 [97] spdep_1.3-5               pkgconfig_2.0.3           gtable_0.3.5             
[100] blob_1.2.4                XVector_0.44.0            htmltools_0.5.8.1        
[103] dotCall64_1.1-1           fftwtools_0.9-11          scales_1.3.0             
[106] png_0.1-8                 attempt_0.3.1             knitr_1.48               
[109] rstudioapi_0.16.0         rjson_0.2.21              curl_5.2.1               
[112] proxy_0.4-27              cachem_1.1.0              rhdf5_2.48.0             
[115] BiocVersion_3.19.1        KernSmooth_2.23-24        vipor_0.4.7              
[118] parallel_4.4.1            AnnotationDbi_1.66.0      restfulr_0.0.15          
[121] s2_1.1.6                  pillar_1.9.0              grid_4.4.1               
[124] vctrs_0.6.5               promises_1.3.0            BiocSingular_1.20.0      
[127] dbplyr_2.5.0              beachmat_2.20.0           xtable_1.8-4             
[130] sfheaders_0.4.4           beeswarm_0.4.0            paletteer_1.6.0          
[133] evaluate_0.24.0           zeallot_0.1.0             magick_2.8.3             
[136] Rsamtools_2.20.0          cli_3.6.3                 locfit_1.5-9.10          
[139] compiler_4.4.1            crayon_1.5.3              labeling_0.4.3           
[142] classInt_0.4-10           rematch2_2.1.2            ggbeeswarm_0.7.2         
[145] viridisLite_0.4.2         deldir_2.0-4              munsell_0.5.1            
[148] Biostrings_2.72.1         lazyeval_0.2.2            tiff_0.1-12              
[151] Matrix_1.7-0              ExperimentHub_2.12.0      benchmarkme_1.0.8        
[154] sparseMatrixStats_1.16.0  bit64_4.0.5               Rhdf5lib_1.26.0          
[157] KEGGREST_1.44.1           statmod_1.5.0             shiny_1.8.1.1            
[160] AnnotationHub_3.12.0      memoise_2.0.1             bslib_0.7.0              
[163] benchmarkmeData_1.0.4     bit_4.0.5                
> sessioninfo::session_info()
─ Session info ────────────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.4.1 RC (2024-06-06 r86719)
 os       macOS Sonoma 14.5
 system   aarch64, darwin20
 ui       RStudio
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       America/Chicago
 date     2024-08-17
 rstudio  2024.07.0-daily+219 Cranberry Hibiscus (desktop)
 pandoc   3.1.11 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/aarch64/ (via rmarkdown)

─ Packages ────────────────────────────────────────────────────────────────────────
 ! package                  * version   date (UTC) lib source
   abind                      1.4-5     2016-07-21 [1] CRAN (R 4.4.0)
   AnnotationDbi              1.66.0    2024-05-01 [1] Bioconductor 3.19 (R 4.4.0)
   AnnotationHub              3.12.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   attempt                    0.3.1     2020-05-03 [1] CRAN (R 4.4.0)
   beachmat                   2.20.0    2024-05-06 [1] Bioconductor 3.19 (R 4.4.0)
   beeswarm                   0.4.0     2021-06-01 [1] CRAN (R 4.4.0)
   benchmarkme                1.0.8     2022-06-12 [1] CRAN (R 4.4.0)
   benchmarkmeData            1.0.4     2020-04-23 [1] CRAN (R 4.4.0)
   Biobase                  * 2.64.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.1)
   BiocFileCache              2.12.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   BiocGenerics             * 0.50.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   BiocIO                     1.14.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   BiocManager                1.30.23   2024-05-04 [1] CRAN (R 4.4.0)
   BiocNeighbors              1.22.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   BiocParallel             * 1.38.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   BiocSingular               1.20.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   BiocVersion                3.19.1    2024-04-22 [1] Bioconductor 3.19 (R 4.4.0)
   Biostrings                 2.72.1    2024-06-02 [1] Bioconductor 3.19 (R 4.4.0)
   bit                        4.0.5     2022-11-15 [1] CRAN (R 4.4.0)
   bit64                      4.0.5     2020-08-30 [1] CRAN (R 4.4.0)
   bitops                     1.0-7     2021-04-24 [1] CRAN (R 4.4.0)
   blob                       1.2.4     2023-03-17 [1] CRAN (R 4.4.0)
   boot                       1.3-30    2024-02-26 [1] CRAN (R 4.4.1)
   bslib                      0.7.0     2024-03-29 [1] CRAN (R 4.4.0)
   cachem                     1.1.0     2024-05-16 [1] CRAN (R 4.4.0)
   class                      7.3-22    2023-05-03 [1] CRAN (R 4.4.1)
   classInt                   0.4-10    2023-09-05 [1] CRAN (R 4.4.0)
 P cli                        3.6.3     2024-06-21 [2] CRAN (R 4.4.0)
   codetools                  0.2-20    2024-03-31 [1] CRAN (R 4.4.1)
   colorout                 * 1.3-0.2   2024-05-01 [1] Github (jalvesaq/colorout@c6113a2)
   colorspace                 2.1-0     2023-01-23 [1] CRAN (R 4.4.0)
   config                     0.3.2     2023-08-30 [1] CRAN (R 4.4.0)
   cowplot                    1.1.3     2024-01-22 [1] CRAN (R 4.4.0)
   crayon                     1.5.3     2024-06-20 [1] CRAN (R 4.4.0)
   curl                       5.2.1     2024-03-01 [1] CRAN (R 4.4.0)
   data.table               * 1.15.4    2024-03-30 [2] CRAN (R 4.4.0)
   DBI                        1.2.3     2024-06-02 [1] CRAN (R 4.4.0)
   dbplyr                     2.5.0     2024-03-19 [1] CRAN (R 4.4.0)
   DelayedArray               0.30.1    2024-05-07 [1] Bioconductor 3.19 (R 4.4.0)
   DelayedMatrixStats         1.26.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   deldir                     2.0-4     2024-02-28 [1] CRAN (R 4.4.0)
   digest                     0.6.36    2024-06-23 [1] CRAN (R 4.4.0)
   doParallel                 1.0.17    2022-02-07 [1] CRAN (R 4.4.1)
   dotCall64                  1.1-1     2023-11-28 [1] CRAN (R 4.4.0)
   dplyr                      1.1.4     2023-11-17 [1] CRAN (R 4.4.0)
   dqrng                      0.4.1     2024-05-28 [1] CRAN (R 4.4.0)
   DropletUtils               1.24.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   DT                         0.33      2024-04-04 [1] CRAN (R 4.4.0)
   e1071                      1.7-14    2023-12-06 [1] CRAN (R 4.4.0)
   EBImage                    4.46.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   edgeR                      4.2.0     2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   evaluate                   0.24.0    2024-06-10 [1] CRAN (R 4.4.0)
   ExperimentHub              2.12.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   fansi                      1.0.6     2023-12-08 [1] CRAN (R 4.4.0)
   farver                     2.1.2     2024-05-13 [1] CRAN (R 4.4.0)
   fastmap                    1.2.0     2024-05-15 [1] CRAN (R 4.4.0)
   fftwtools                  0.9-11    2021-03-01 [1] CRAN (R 4.4.0)
   fields                     16.2      2024-06-27 [1] CRAN (R 4.4.0)
   filelock                   1.0.3     2023-12-11 [1] CRAN (R 4.4.0)
   foreach                    1.5.2     2022-02-02 [1] CRAN (R 4.4.0)
   generics                   0.1.3     2022-07-05 [1] CRAN (R 4.4.0)
   GenomeInfoDb             * 1.40.1    2024-05-24 [1] Bioconductor 3.19 (R 4.4.0)
   GenomeInfoDbData           1.2.12    2024-05-01 [1] Bioconductor
   GenomicAlignments          1.40.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   GenomicRanges            * 1.56.1    2024-06-12 [1] Bioconductor 3.19 (R 4.4.1)
   ggbeeswarm                 0.7.2     2023-04-29 [1] CRAN (R 4.4.0)
   ggplot2                  * 3.5.1     2024-04-23 [1] CRAN (R 4.4.0)
   ggrepel                    0.9.5     2024-01-10 [1] CRAN (R 4.4.0)
   glue                       1.7.0     2024-01-09 [1] CRAN (R 4.4.0)
   golem                      0.4.1     2023-06-05 [1] CRAN (R 4.4.0)
   gridExtra                * 2.3       2017-09-09 [1] CRAN (R 4.4.0)
   gtable                     0.3.5     2024-04-22 [1] CRAN (R 4.4.0)
   HDF5Array                  1.32.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   here                       1.0.1     2020-12-13 [1] CRAN (R 4.4.0)
   htmltools                  0.5.8.1   2024-04-04 [1] CRAN (R 4.4.0)
   htmlwidgets                1.6.4     2023-12-06 [1] CRAN (R 4.4.0)
   httpuv                     1.6.15    2024-03-26 [1] CRAN (R 4.4.0)
   httr                       1.4.7     2023-08-15 [1] CRAN (R 4.4.0)
   IRanges                  * 2.38.1    2024-07-03 [1] Bioconductor 3.19 (R 4.4.1)
   irlba                      2.3.5.1   2022-10-03 [1] CRAN (R 4.4.0)
   iterators                  1.0.14    2022-02-05 [1] CRAN (R 4.4.0)
   jpeg                       0.1-10    2022-11-29 [1] CRAN (R 4.4.0)
   jquerylib                  0.1.4     2021-04-26 [1] CRAN (R 4.4.0)
   jsonlite                   1.8.8     2023-12-04 [1] CRAN (R 4.4.0)
   KEGGREST                   1.44.1    2024-06-19 [1] Bioconductor 3.19 (R 4.4.0)
   KernSmooth                 2.23-24   2024-05-17 [1] CRAN (R 4.4.1)
   knitr                      1.48      2024-07-07 [1] CRAN (R 4.4.1)
   labeling                   0.4.3     2023-08-29 [1] CRAN (R 4.4.0)
   later                      1.3.2     2023-12-06 [1] CRAN (R 4.4.0)
   lattice                    0.22-6    2024-03-20 [1] CRAN (R 4.4.1)
   lazyeval                   0.2.2     2019-03-15 [1] CRAN (R 4.4.0)
   lifecycle                  1.0.4     2023-11-07 [1] CRAN (R 4.4.0)
   limma                      3.60.3    2024-06-16 [1] Bioconductor 3.19 (R 4.4.0)
   locfit                     1.5-9.10  2024-06-24 [1] CRAN (R 4.4.0)
   magick                     2.8.3     2024-02-18 [1] CRAN (R 4.4.0)
   magrittr                   2.0.3     2022-03-30 [1] CRAN (R 4.4.0)
   maps                       3.4.2     2023-12-15 [1] CRAN (R 4.4.0)
   Matrix                     1.7-0     2024-04-26 [1] CRAN (R 4.4.1)
   MatrixGenerics           * 1.16.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   matrixStats              * 1.3.0     2024-04-11 [1] CRAN (R 4.4.0)
   memoise                    2.0.1     2021-11-26 [1] CRAN (R 4.4.0)
   mime                       0.12      2021-09-28 [1] CRAN (R 4.4.0)
   munsell                    0.5.1     2024-04-01 [1] CRAN (R 4.4.0)
   paletteer                  1.6.0     2024-01-21 [1] CRAN (R 4.4.0)
   parallelly               * 1.38.0    2024-07-27 [1] CRAN (R 4.4.0)
   pillar                     1.9.0     2023-03-22 [1] CRAN (R 4.4.0)
   pkgconfig                  2.0.3     2019-09-22 [1] CRAN (R 4.4.0)
   plotly                     4.10.4    2024-01-13 [1] CRAN (R 4.4.0)
   png                        0.1-8     2022-11-29 [1] CRAN (R 4.4.0)
   promises                   1.3.0     2024-04-05 [1] CRAN (R 4.4.0)
   proxy                      0.4-27    2022-06-09 [1] CRAN (R 4.4.0)
   purrr                      1.0.2     2023-08-10 [1] CRAN (R 4.4.0)
   R.methodsS3                1.8.2     2022-06-13 [1] CRAN (R 4.4.0)
   R.oo                       1.26.0    2024-01-24 [1] CRAN (R 4.4.0)
   R.utils                    2.12.3    2023-11-18 [1] CRAN (R 4.4.0)
   R6                         2.5.1     2021-08-19 [1] CRAN (R 4.4.0)
   rappdirs                   0.3.3     2021-01-31 [1] CRAN (R 4.4.0)
   RColorBrewer               1.1-3     2022-04-03 [1] CRAN (R 4.4.0)
   Rcpp                       1.0.13    2024-07-17 [1] CRAN (R 4.4.0)
   RCurl                      1.98-1.14 2024-01-09 [1] CRAN (R 4.4.0)
   rematch2                   2.1.2     2020-05-01 [1] CRAN (R 4.4.0)
   restfulr                   0.0.15    2022-06-16 [1] CRAN (R 4.4.0)
   rhdf5                      2.48.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   rhdf5filters               1.16.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   Rhdf5lib                   1.26.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   rjson                      0.2.21    2022-01-09 [1] CRAN (R 4.4.0)
 P rlang                    * 1.1.4     2024-06-04 [2] CRAN (R 4.4.1)
   rmarkdown                  2.27      2024-05-17 [1] CRAN (R 4.4.0)
   rprojroot                  2.0.4     2023-11-05 [1] CRAN (R 4.4.0)
   Rsamtools                  2.20.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   RSQLite                    2.3.7     2024-05-27 [1] CRAN (R 4.4.0)
   rstudioapi                 0.16.0    2024-03-24 [1] CRAN (R 4.4.0)
   rsvd                       1.0.5     2021-04-16 [1] CRAN (R 4.4.0)
   rtracklayer                1.64.0    2024-05-06 [1] Bioconductor 3.19 (R 4.4.0)
   s2                         1.1.6     2023-12-19 [1] CRAN (R 4.4.0)
   S4Arrays                   1.4.1     2024-05-20 [1] Bioconductor 3.19 (R 4.4.0)
   S4Vectors                * 0.42.1    2024-07-03 [1] Bioconductor 3.19 (R 4.4.1)
   sass                       0.4.9     2024-03-15 [1] CRAN (R 4.4.0)
   ScaledMatrix               1.12.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   scales                     1.3.0     2023-11-28 [1] CRAN (R 4.4.0)
   scater                     1.32.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   scuttle                    1.14.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   sessioninfo                1.2.2     2021-12-06 [1] CRAN (R 4.4.0)
   sf                         1.0-16    2024-03-24 [1] CRAN (R 4.4.0)
   sfheaders                  0.4.4     2024-01-17 [1] CRAN (R 4.4.0)
   shiny                      1.8.1.1   2024-04-02 [1] CRAN (R 4.4.0)
   shinyWidgets               0.8.6     2024-04-24 [1] CRAN (R 4.4.0)
   SingleCellExperiment     * 1.26.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   sp                         2.1-4     2024-04-30 [1] CRAN (R 4.4.0)
   spam                       2.10-0    2023-10-23 [1] CRAN (R 4.4.0)
   SparseArray                1.4.8     2024-05-30 [1] Bioconductor 3.19 (R 4.4.0)
   sparseMatrixStats          1.16.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   SpatialExperiment        * 1.14.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   SpatialFeatureExperiment * 1.6.1     2024-05-15 [1] Bioconductor 3.19 (R 4.4.0)
   spatialLIBD              * 1.16.2    2024-05-28 [1] Bioconductor 3.19 (R 4.4.0)
   spData                     2.3.1     2024-05-31 [1] CRAN (R 4.4.0)
   spdep                      1.3-5     2024-06-10 [1] CRAN (R 4.4.0)
   statmod                    1.5.0     2023-01-06 [1] CRAN (R 4.4.0)
   SummarizedExperiment     * 1.34.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   terra                      1.7-78    2024-05-22 [1] CRAN (R 4.4.0)
   tibble                     3.2.1     2023-03-20 [1] CRAN (R 4.4.0)
   tidyr                      1.3.1     2024-01-24 [1] CRAN (R 4.4.0)
   tidyselect                 1.2.1     2024-03-11 [1] CRAN (R 4.4.0)
   tiff                       0.1-12    2023-11-28 [1] CRAN (R 4.4.0)
   UCSC.utils                 1.0.0     2024-05-06 [1] Bioconductor 3.19 (R 4.4.0)
   units                      0.8-5     2023-11-28 [1] CRAN (R 4.4.0)
   utf8                       1.2.4     2023-10-22 [1] CRAN (R 4.4.0)
   vctrs                      0.6.5     2023-12-01 [1] CRAN (R 4.4.0)
   vipor                      0.4.7     2023-12-18 [1] CRAN (R 4.4.0)
   viridis                    0.6.5     2024-01-29 [1] CRAN (R 4.4.0)
   viridisLite                0.4.2     2023-05-02 [1] CRAN (R 4.4.0)
   withr                      3.0.0     2024-01-16 [1] CRAN (R 4.4.0)
   wk                         0.9.2     2024-07-09 [1] CRAN (R 4.4.0)
   xfun                       0.45      2024-06-16 [1] CRAN (R 4.4.0)
   XML                        3.99-0.17 2024-06-25 [1] CRAN (R 4.3.3)
   xtable                     1.8-4     2019-04-21 [1] CRAN (R 4.4.0)
   XVector                    0.44.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)
   yaml                       2.3.9     2024-07-05 [1] CRAN (R 4.4.0)
   zeallot                    0.1.0     2018-01-28 [1] CRAN (R 4.4.0)
   zlibbioc                   1.50.0    2024-04-30 [1] Bioconductor 3.19 (R 4.4.0)

 [1] /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library
 [2] /Users/bmulvey/Library/R/arm64/4.4/library

 P ── Loaded and on-disk path mismatch.

───────────────────────────────────────────────────────────────────────────────────
