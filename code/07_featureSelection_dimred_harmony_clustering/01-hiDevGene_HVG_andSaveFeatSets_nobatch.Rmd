---
title: "02-hiDevGene_HVG_andSaveFeatSets_nobatch"
author: "Bernie Mulvey"
date: "2024-12-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.height = 10,fig.width = 7,include = FALSE)
#### sets tab autocompletion for directories to begin from the directory containing the .Rproj session, instead of the script's directory if different
knitr::opts_knit$set(root.dir = here::here())

library(data.table)
library(ggplot2)
library(ggtext)
library(gridExtra)
library(SpatialExperiment)
library(scater)
library(scran)
library(scry) # get null residuals
# library(SpatialFeatureExperiment)

## rstudio GUI tweaks
require(colorout)
ColorOut()
options("styler.addins_style_transformer" = "biocthis::bioc_style()")
##

## enable forked parallel processing with BiocParallel::multicoreParam, future::, etc. seemed to need this a couple times, but otherwise havent so its here as a preventative measure. part of this is adding the line 
# OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES
# to Renviron.site. see e.g. top response on https://stackoverflow.com/questions/73638290/python-on-mac-is-it-safe-to-set-objc-disable-initialize-fork-safety-yes-globall 
library(parallelly)
options(parallelly.supportsMulticore.disableOn="")
options(parallelly.fork.enable=TRUE)
library(BiocParallel)
options(bphost="localhost")


## ggplot defaults
theme_set(theme_bw()+theme(axis.text.x = element_text(size = 9), axis.title.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.y = element_text(size =9), plot.title = element_markdown(size = 11,hjust=0.5), strip.text = element_text(size=11), legend.text = element_text(size=8), legend.title = element_text(size=9,hjust=0.5)))

## last of all, unload the base package datasets, whose data keep getting in the way of autocompletions (e.g., Theoph is priortized over TRUE)
unloadNamespace("datasets")
```

# load sectionwise, filtered, lognormed SPE
```{r}
lc3 <- readRDS("processed-data/06-QCed_SPE_split_to_tissSections.RDS")
```

# Right now, we do NOT want to incorporate any batch effects in any of these analyses -- we won't be able to determine what to correct for until we get thru dimensionality reduction.

###

# Feature type 1: binomial gene deviance residuals (an HVG-alike method that uses non-log normalized data. package scry). We already calculated high-deviance genes without covariates, covarying by slide, or covarying by donor in code/04-QC script #5. Since the spots themselves (and for that matter, their pairings to covariates of donor or slide) remain unchanged by splitting the capture areas in half, so we can (thankfully, as these calculations required on the order of 600 GB RAM) use those for identifying HDGs.

In other words, as Jacqui (power user of HDGs) says affirming this approach: "because you didn't specify any covariates/batch for the devianceFeatureSelection it doesn't matter if you did or did not split the capture area since the model was agnostic to the origin of any and all spots"

```{r}
devgen <- fread("processed-data/04_QC/05-deviance_binomial_gene_deviances_panSPE_brnumAsBatch_or_slideAsBatch.txt")

## for now we only want the deviances/ranks under a no batch condition
devgen <- devgen[,.(gene_id,gene_name,dev_nobatch,rank_nobatch)]
```

# Feature type 2: HVGs (typical approach, uses logcounts). Again, no batching variable to begin with.
```{r}
lv <- modelGeneVar(lc3)
## get all variable genes for now
hvg <- scran::getTopHVGs(lv,prop=1.0)

hvgtab <- cbind(hvg,seq(1,length(hvg),1))
colnames(hvgtab) <- c("gene_id","HVG_rank")
hvgtab <- merge.data.table(as.data.table(hvgtab),as.data.table(rowData(lc3))[,.(gene_id,gene_name)],by="gene_id")
hvgtab[,HVG_rank:=as.numeric(HVG_rank)]


fwrite(hvgtab,"processed-data/07_featureSelection_dimred_harmony_clustering/01a_TopHVGs_prop1.0_nobatch.txt",sep='\t',quote=F)

rm(lv)
```

# The computationally hairy one here is SVGs. 
```{r}
# The workhorse function nnSVG has parallelization cooked in..but that's going to copy over the whole effing environment to all workers. so its way easier if we temporarily save single-sample RDSes, clear the deck, load the single sample RDS, run nnsvg, store results in-session, rinse, repeat.
caps <- unique(lc3$sample_id)
lsamps <- lapply(caps,FUN=function(x){lc3[,lc3$sample_id==x]})
names(lsamps) <- caps

mapply(s=lsamps,n=names(lsamps),SIMPLIFY=FALSE,FUN=function(s,n){saveRDS(s,paste0("code/07_featureSelection_dimred_harmony_clustering/01a_tmp_nnsvg_in/",n,".RDS"))})

## don't clear the environment JUST yet--so that we can work out some parameters for pre-nnSVG gene filtering

# A good test to calibrate the proportion requirement is to look at the proportion of spots with ≥ 1, 2, 3,... counts of what we know will be an SVG -- LC marker DBH. Keep in mind though that DBH is a relatively highly expressed gene, while other cell type-exclusive genes may not (e.g., transcription factor/raphe marker FEV).

sum(counts(lc3)["ENSG00000123454",]>0) # 18751
sum(counts(lc3)["ENSG00000123454",]>1) # 8953
sum(counts(lc3)["ENSG00000123454",]>2) # 6344
sum(counts(lc3)["ENSG00000123454",]>3) # 5055
sum(counts(lc3)["ENSG00000123454",]>4) # 4275
sum(counts(lc3)["ENSG00000123454",]>5) # 3685

# there are 132484 spots total, so these proportions work out to 14.2%, 6.8%, 4.8%, 3.8%, 3.2%, 2.8%, respectively.

# to balance computing time, gene specificity, and potential for highly specific genes to be expressed much more lowly than DBH (eg FEV per above), let's start with N=2 and S=2 (i.e. include genes for which 2% of sample spots have >=2 counts)

# now we can clear out the big spe and load tiny ones iteratively
rm(lsamps,lc3)
gc(full=T)

## initialize list to hold results
svgres_list <- as.list(rep("",times=length(caps)))


##
## actual NNSVG runs
## 

# SUPER CRITICAL IMPORTANT NOTES: 
# 1. RECALCULATE LOG COUNTS AFTER FILTERING ^
# 2.nnSVG works ONE SAMPLE (one capture area) at a time. So need to wrap this in a loop. 
# 3. as such, perform filtering PER SAMPLE. 
# filter_genes_ncounts (N) and filter_genes_pcspots (S) work together: genes will be filtered to those with at least N counts in at least S% of spots.  filter_genes_pcspots expects a %age as 0-100, NOT a fraction.


## Iterate nnsvg by sample

i<-1
for (i in c(1:length(caps))){
  l.samp <- readRDS(paste0("code/07_featureSelection_dimred_harmony_clustering/01a_tmp_nnsvg_in/",caps[i],".RDS"))

  ### to identify new rowData columns added by nnsvg, we need to know how many there are to start with:
  rdind <- ncol(rowData(l.samp))
  
  message(paste0(Sys.time()," - Starting sample ",caps[i]," (",i," of ",length(caps),")"))
  
  l.samp <- filter_genes(l.samp,filter_genes_ncounts = 2,filter_genes_pcspots = 2,filter_mito = F)
    
  #recalculate logcounts after filtering for nnsvg-able genes
  l.samp <- computeLibraryFactors(l.samp)
  l.samp <- logNormCounts(l.samp)
    
  # main call -- defaults to logcounts but shown for posterity; X if using covariates; n_neighbors defaults to 10, slower but potentially more granular with higher values eg 15, order = don't touch unless you have < 70 spots total; n_threads or BPPARAM for parallelization
  l.samp <- nnSVG(l.samp,assay_name = "logcounts",n_threads = 10)
  
    # extract results; using index of the last column of original rowdata to determine where nnSVG-appended columns begin; add nnSVG_ to those column names so we can tell them apart
  rdstartind <- rdind+1
  colnames(rowData(l.samp))[rdstartind:ncol(rowData(l.samp))] <- paste0("nnSVG_",colnames(rowData(l.samp))[rdstartind:ncol(rowData(l.samp))])

  # extract the nnsvg results from the rowData and store it in the result list. we don't need the rownames for storage since they're redundant with the ensembl identifier column in rowdata.
  outtab <- as.data.table(as.data.frame(rowData(l.samp)),keep.rownames=T)
  svgres_list[[i]] <- copy(outtab)
  names(svgres_list)[i] <- caps[i]
  
  rm(outtab,rdstartind,l.samp,rdind)
  gc(full=T)
}
# output messages from the nnSVG runs are at the end of the rmd

saveRDS(svgres_list,"processed-data/07_featureSelection_dimred_harmony_clustering/01b-nnSVG_n2s2_nobatch_out.RDS")

# get a table of genes with nomsig spatvar and their nnSVG ranks across all samples

i<-1
for (i in c(1:length(svgres_list))){
    if(i==1){
        nnsvg_ranks <- svgres_list[[i]][nnSVG_padj<0.05]
        nnsvg_ranks <- nnsvg_ranks[,.(gene_id,gene_name,nnSVG_rank)]
        setnames(nnsvg_ranks,"nnSVG_rank",names(svgres_list)[i])
    }
    else{
        tmp <- svgres_list[[i]][nnSVG_padj<0.05]
        tmp <- tmp[,.(gene_id,gene_name,nnSVG_rank)]
        setnames(tmp,"nnSVG_rank",names(svgres_list)[i])
        nnsvg_ranks <- merge.data.table(nnsvg_ranks, tmp, by=c("gene_id","gene_name"), all.x=T, all.y=T, incomparables = NA)
        rm(tmp)
    }
}
rm(i)

## get mean rank, number of samples signif, and proportion of samples from donor signif
nnsvg_ranks[,meanrank:=rowMeans(.SD,na.rm=T),.SDcols=c(3:ncol(nnsvg_ranks))]
nnsvg_ranks[,samples_signif:=rowSums(!is.na(.SD)),.SDcols=c(3:(ncol(nnsvg_ranks)-1))]

fwrite(nnsvg_ranks,"processed-data/07_featureSelection_dimred_harmony_clustering/01c-nnsvg_s2n2_nobatch_meangeneranks.txt",sep='\t',quote=F)
```


In the hypothalamus dataset, using  N = [the number of genes returned by scran::getTopHVGs with prop=0.1] for feature selection worked better than prop=0.2 for HVGs but also with SVGs. So let's determine that N and then make feature sets accordingly.
```{r}
nfeat <- round(0.1*nrow(hvgtab))
# 1397
```

•Feature sets minimizing effects of lognorm/zero inflation: 
Feature selection and GLMPCA dimensionality reduction using N features:
	1. top N highly deviant genes (HDGs) (i.e. also ascertained in a lognorm-free manner)
	2. top N SVGs (nnsvg uses lognorm) -
	3. Top N/2 HDGs and top N/2 SVGs
	4. Top N/4 HDGs and top 3N/4 SVGs
	5. Top 3N/4 HDGs and top N/4 SVGs
	
SVGs should be selected using their mean rank when only considering genes with nominally signif spatial variability in ≥50% (>42) of the 85 samples.
```{r}
nnsvg_tmp <- nnsvg_ranks[samples_signif>42]

featlist <- list()

setorderv(devgen,"rank_nobatch")
featlist[[1]] <- devgen[1:nfeat,gene_id]

## check how many genes meet the 50% of samples cutoff
nrow(nnsvg_tmp) # 762 -- less than our 1397 minimum. so just take the 762 here (otherwise data table gives back empty rows to fill the remainder)
setorderv(nnsvg_tmp,"meanrank")
featlist[[2]] <- nnsvg_tmp[samples_signif>42][c(1:min(nfeat,nrow(nnsvg_tmp))),gene_id]

# nnsvg_tmp[!(gene_id %in% featlist[[1]]),gene_id]
## the HDG-SVG combo is almost pointless here. all but 6 of the SVGs are also in the top nfeat HDGs -- so at this point we're going to end up with a feature set that's still (nfeat-6)/nfeat = 99.6% of the HDGs.

## ## ## however, the SVG-only genes ARE interesting: GABRE, DDC, SEZ6, PLCXD3, SV2B, TMEM35A ## ## ##

## so we'll make this set anyhow, though it probably will yield almost identical clustering. probably.
featlist[[3]] <- unique(c(featlist[[1]][c(1:(nfeat-6))],
                  nnsvg_tmp[!(gene_id %in% featlist[[1]][1:(nfeat-6)]),gene_id]))

### anywho, the other two sets we'll just make as described. these will be smaller sets than the first three.
featlist[[4]] <- unique(c(featlist[[1]][1:(nfeat/4)],featlist[[2]][1:min(3*nfeat/4,nrow(nnsvg_tmp))]))
## ^ 766 genes

featlist[[5]] <- unique(c(featlist[[1]][1:(3*nfeat/4)],featlist[[2]][1:min(nfeat/4,nrow(nnsvg_tmp))]))
## ^ 1053 genes

names(featlist) <- c("HDG_1397","nnSVG_1397","HDG1391_SVGexclusive6","HDG_SVG_2575","HDG_SVG_7525")
```

## Then another 4 sets using HVGs instead of HDGs:
```{r}
setorderv(hvgtab,"HVG_rank")
featlist[[6]] <- hvgtab[1:nfeat,gene_id]

# nnsvg_ranks[!(gene_id %in% featlist[[6]])&samples_signif>42,gene_id]
# 523 of the SVGs are not in the top nfeat HVGs so these are majority exclusive sets.
featlist[[7]] <- unique(c(featlist[[6]][1:(nfeat/2)],featlist[[2]][1:min(nfeat/2,nrow(nnsvg_tmp))]))
## 1210 genes ^

featlist[[8]] <- unique(c(featlist[[6]][1:(nfeat/4)],featlist[[2]][1:min(3*nfeat/4,nrow(nnsvg_tmp))]))
## 960 ^

featlist[[9]] <- unique(c(featlist[[6]][1:(3*nfeat/4)],featlist[[2]][1:min(nfeat/4,nrow(nnsvg_tmp))]))
# 1257 ^

names(featlist)[6:9] <- c("HVG_1397","HVG_SVG_5050","HVG_SVG_2575","HVG_SVG_7525")

## make sure there's no NAs in the gene lists
stopifnot(sum(unlist(lapply(featlist,function(x){sum(is.na(x))})))==0)
# save
saveRDS(featlist,"processed-data/07_featureSelection_dimred_harmony_clustering/01d_HiDevG_HVG_SVG_andmixed_featsets.RDS")
```

### reprod info and R messages ### 

# nnSVG messages #

2024-12-21 15:02:02.13015 - Starting sample V13M06-331_A1s2 (1 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 49) of spatial locations
removed 28542 out of 29877 genes due to low expression
2024-12-21 15:03:53.912007 - Starting sample V13M06-331_A1s1 (2 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 32) of spatial locations
removed 28548 out of 29877 genes due to low expression
2024-12-21 15:05:24.4993 - Starting sample V13M06-331_B1s1 (3 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 36) of spatial locations
removed 28756 out of 29877 genes due to low expression
2024-12-21 15:06:48.199243 - Starting sample V13M06-331_B1s2 (4 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 21) of spatial locations
removed 28568 out of 29877 genes due to low expression
2024-12-21 15:08:09.68914 - Starting sample V13M06-331_C1s2 (5 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 23) of spatial locations
removed 25144 out of 29877 genes due to low expression
2024-12-21 15:13:06.683036 - Starting sample V13M06-331_C1s1 (6 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 28) of spatial locations
removed 25984 out of 29877 genes due to low expression
2024-12-21 15:17:24.946863 - Starting sample V13M06-331_D1s1 (7 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 27) of spatial locations
removed 26642 out of 29877 genes due to low expression
2024-12-21 15:20:57.022262 - Starting sample V13M06-331_D1s2 (8 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 27) of spatial locations
removed 26711 out of 29877 genes due to low expression
2024-12-21 15:24:23.522086 - Starting sample V13M06-333_A1s2 (9 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 31) of spatial locations
removed 25737 out of 29877 genes due to low expression
2024-12-21 15:29:11.746424 - Starting sample V13M06-333_A1s1 (10 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 45) of spatial locations
removed 24691 out of 29877 genes due to low expression
2024-12-21 15:36:28.023037 - Starting sample V13M06-333_B1s1 (11 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 33) of spatial locations
removed 26001 out of 29877 genes due to low expression
2024-12-21 15:40:55.766199 - Starting sample V13M06-333_B1s2 (12 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 35) of spatial locations
removed 25697 out of 29877 genes due to low expression
2024-12-21 15:46:05.327804 - Starting sample V13M06-333_C1s2 (13 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 28) of spatial locations
removed 24261 out of 29877 genes due to low expression
2024-12-21 15:52:37.325956 - Starting sample V13M06-333_C1s1 (14 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 43) of spatial locations
removed 24125 out of 29877 genes due to low expression
2024-12-21 16:00:58.825161 - Starting sample V13M06-333_D1s1 (15 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 18) of spatial locations
removed 24974 out of 29877 genes due to low expression
2024-12-21 16:05:49.869086 - Starting sample V13M06-333_D1s2 (16 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 22) of spatial locations
removed 24915 out of 29877 genes due to low expression
2024-12-21 16:10:55.902854 - Starting sample V13M06-332_A1s2 (17 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 33) of spatial locations
removed 26715 out of 29877 genes due to low expression
2024-12-21 16:14:50.801925 - Starting sample V13M06-332_A1s1 (18 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 34) of spatial locations
removed 28687 out of 29877 genes due to low expression
2024-12-21 16:17:01.97074 - Starting sample V13M06-332_B1s1 (19 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 34) of spatial locations
removed 26637 out of 29877 genes due to low expression
2024-12-21 16:20:59.607048 - Starting sample V13M06-332_B1s2 (20 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 28) of spatial locations
removed 26849 out of 29877 genes due to low expression
2024-12-21 16:24:17.838224 - Starting sample V13M06-332_C1s1 (21 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 23) of spatial locations
removed 29237 out of 29877 genes due to low expression
2024-12-21 16:24:59.122104 - Starting sample V13M06-332_C1s2 (22 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 32) of spatial locations
removed 29513 out of 29877 genes due to low expression
2024-12-21 16:25:26.788977 - Starting sample V13M06-332_D1s2 (23 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 36) of spatial locations
removed 26868 out of 29877 genes due to low expression
2024-12-21 16:29:01.528508 - Starting sample V13M06-332_D1s1 (24 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 32) of spatial locations
removed 26008 out of 29877 genes due to low expression
2024-12-21 16:33:32.750346 - Starting sample V13M06-404_A1s1 (25 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 29) of spatial locations
removed 27346 out of 29877 genes due to low expression
2024-12-21 16:36:21.326364 - Starting sample V13M06-404_A1s2 (26 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 34) of spatial locations
removed 27399 out of 29877 genes due to low expression
2024-12-21 16:39:17.823431 - Starting sample V13M06-404_B1s2 (27 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 33) of spatial locations
removed 27329 out of 29877 genes due to low expression
2024-12-21 16:42:16.10378 - Starting sample V13M06-404_B1s1 (28 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 33) of spatial locations
removed 27168 out of 29877 genes due to low expression
2024-12-21 16:45:24.594812 - Starting sample V13M06-404_C1s1 (29 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 32) of spatial locations
removed 28730 out of 29877 genes due to low expression
2024-12-21 16:46:46.017426 - Starting sample V13M06-404_C1s2 (30 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 31) of spatial locations
removed 28943 out of 29877 genes due to low expression
2024-12-21 16:47:52.625295 - Starting sample V13M06-404_D1s1 (31 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 36) of spatial locations
removed 27804 out of 29877 genes due to low expression
2024-12-21 16:50:26.165304 - Starting sample V13M06-404_D1s2 (32 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 36) of spatial locations
removed 28367 out of 29877 genes due to low expression
2024-12-21 16:52:18.807834 - Starting sample V13M06-403_A1s1 (33 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 26) of spatial locations
removed 29044 out of 29877 genes due to low expression
2024-12-21 16:53:13.39208 - Starting sample V13M06-403_A1s2 (34 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 28) of spatial locations
removed 29055 out of 29877 genes due to low expression
2024-12-21 16:54:09.128282 - Starting sample V13M06-403_B1s2 (35 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 26) of spatial locations
removed 29678 out of 29877 genes due to low expression
2024-12-21 16:54:24.511629 - Starting sample V13M06-403_B1s1 (36 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 27) of spatial locations
removed 29609 out of 29877 genes due to low expression
2024-12-21 16:54:44.2629 - Starting sample V13M06-403_C1s1 (37 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 28) of spatial locations
removed 29661 out of 29877 genes due to low expression
2024-12-21 16:55:01.567393 - Starting sample V13M06-403_C1s2 (38 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 28) of spatial locations
removed 29724 out of 29877 genes due to low expression
2024-12-21 16:55:14.903206 - Starting sample V13M06-403_D1s1 (39 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 28) of spatial locations
removed 28999 out of 29877 genes due to low expression
2024-12-21 16:56:16.51232 - Starting sample V13M06-403_D1s2 (40 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 34) of spatial locations
removed 28908 out of 29877 genes due to low expression
2024-12-21 16:57:26.00792 - Starting sample V13M06-402_A1s1 (41 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 40) of spatial locations
removed 27436 out of 29877 genes due to low expression
2024-12-21 17:00:27.4666 - Starting sample V13M06-402_A1s2 (42 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 33) of spatial locations
removed 27456 out of 29877 genes due to low expression
2024-12-21 17:03:17.716327 - Starting sample V13M06-402_B1s1 (43 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 27) of spatial locations
removed 27647 out of 29877 genes due to low expression
2024-12-21 17:05:43.719544 - Starting sample V13M06-402_B1s2 (44 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 27) of spatial locations
removed 28144 out of 29877 genes due to low expression
2024-12-21 17:07:37.790001 - Starting sample V13M06-402_C1s2 (45 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 22) of spatial locations
removed 27910 out of 29877 genes due to low expression
2024-12-21 17:09:39.351967 - Starting sample V13M06-402_C1s1 (46 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 20) of spatial locations
removed 28078 out of 29877 genes due to low expression
2024-12-21 17:11:29.114435 - Starting sample V13M06-402_D1s1 (47 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 36) of spatial locations
removed 28977 out of 29877 genes due to low expression
2024-12-21 17:12:34.730583 - Starting sample V13M06-402_D1s2 (48 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 23) of spatial locations
removed 28850 out of 29877 genes due to low expression
2024-12-21 17:13:39.456794 - Starting sample V13M06-401_A1s1 (49 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 36) of spatial locations
removed 27854 out of 29877 genes due to low expression
2024-12-21 17:16:05.466951 - Starting sample V13M06-401_A1s2 (50 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 33) of spatial locations
removed 26879 out of 29877 genes due to low expression
2024-12-21 17:19:34.523194 - Starting sample V13M06-401_B1s1 (51 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 33) of spatial locations
removed 27232 out of 29877 genes due to low expression
2024-12-21 17:22:38.927429 - Starting sample V13M06-401_B1s2 (52 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 30) of spatial locations
removed 26497 out of 29877 genes due to low expression
2024-12-21 17:26:26.828542 - Starting sample V13M06-401_C1s1 (53 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 26) of spatial locations
removed 28849 out of 29877 genes due to low expression
2024-12-21 17:27:33.153961 - Starting sample V13M06-401_C1s2 (54 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 25) of spatial locations
removed 29020 out of 29877 genes due to low expression
2024-12-21 17:28:30.0598 - Starting sample V13M06-401_D1s1 (55 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 35) of spatial locations
removed 27039 out of 29877 genes due to low expression
2024-12-21 17:31:51.437844 - Starting sample V13M06-401_D1s2 (56 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 29) of spatial locations
removed 26871 out of 29877 genes due to low expression
2024-12-21 17:35:12.011392 - Starting sample V13M06-386_A1s2 (57 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 25) of spatial locations
removed 28498 out of 29877 genes due to low expression
2024-12-21 17:36:40.286584 - Starting sample V13M06-386_A1s1 (58 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 27) of spatial locations
removed 28485 out of 29877 genes due to low expression
2024-12-21 17:38:12.993093 - Starting sample V13M06-386_B1s2 (59 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 31) of spatial locations
removed 29558 out of 29877 genes due to low expression
2024-12-21 17:38:38.366163 - Starting sample V13M06-386_B1s1 (60 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 18) of spatial locations
removed 29666 out of 29877 genes due to low expression
2024-12-21 17:38:53.501738 - Starting sample V13M06-386_C1s1 (61 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 36) of spatial locations
removed 28453 out of 29877 genes due to low expression
2024-12-21 17:40:37.71112 - Starting sample V13M06-386_C1s2 (62 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 29) of spatial locations
removed 28068 out of 29877 genes due to low expression
2024-12-21 17:42:38.060494 - Starting sample V13M06-386_D1s2 (63 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 33) of spatial locations
removed 28693 out of 29877 genes due to low expression
2024-12-21 17:44:01.562608 - Starting sample V13M06-386_D1s1 (64 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 22) of spatial locations
removed 29151 out of 29877 genes due to low expression
2024-12-21 17:44:48.135093 - Starting sample V13B23-366_A1s1 (65 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 88) of spatial locations
removed 28925 out of 29877 genes due to low expression
2024-12-21 17:46:36.352957 - Starting sample V13B23-284_A1s2 (66 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 35) of spatial locations
removed 29328 out of 29877 genes due to low expression
2024-12-21 17:47:17.819097 - Starting sample V13B23-284_A1s1 (67 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 39) of spatial locations
removed 27917 out of 29877 genes due to low expression
2024-12-21 17:49:43.37204 - Starting sample V13B23-284_B1s2 (68 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 35) of spatial locations
removed 27648 out of 29877 genes due to low expression
2024-12-21 17:52:22.375664 - Starting sample V13B23-284_B1s1 (69 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 27) of spatial locations
removed 28617 out of 29877 genes due to low expression
2024-12-21 17:53:45.032261 - Starting sample V13B23-284_C1s2 (70 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 27) of spatial locations
removed 28945 out of 29877 genes due to low expression
2024-12-21 17:54:48.002872 - Starting sample V13B23-284_C1s1 (71 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 34) of spatial locations
removed 28627 out of 29877 genes due to low expression
2024-12-21 17:56:18.231792 - Starting sample V13B23-284_D1s1 (72 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 42) of spatial locations
removed 29076 out of 29877 genes due to low expression
2024-12-21 17:57:19.295653 - Starting sample V13B23-284_D1s2 (73 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 34) of spatial locations
removed 29127 out of 29877 genes due to low expression
2024-12-21 17:58:13.619903 - Starting sample V13F27-339_A1s1 (74 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 33) of spatial locations
removed 28002 out of 29877 genes due to low expression
2024-12-21 18:00:24.804681 - Starting sample V13F27-339_A1s2 (75 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 41) of spatial locations
removed 28812 out of 29877 genes due to low expression
2024-12-21 18:01:47.359295 - Starting sample V13F27-339_B1s1 (76 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 27) of spatial locations
removed 27676 out of 29877 genes due to low expression
2024-12-21 18:04:12.304725 - Starting sample V13F27-339_B1s2 (77 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 28) of spatial locations
removed 27962 out of 29877 genes due to low expression
2024-12-21 18:06:19.910104 - Starting sample V13F27-339_C1s2 (78 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 31) of spatial locations
removed 26807 out of 29877 genes due to low expression
2024-12-21 18:09:53.73229 - Starting sample V13F27-339_C1s1 (79 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 29) of spatial locations
removed 26001 out of 29877 genes due to low expression
2024-12-21 18:14:16.112684 - Starting sample V13F27-339_D1s2 (80 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 27) of spatial locations
removed 29219 out of 29877 genes due to low expression
2024-12-21 18:15:00.914717 - Starting sample V13F27-339_D1s1 (81 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 31) of spatial locations
removed 29097 out of 29877 genes due to low expression
2024-12-21 18:15:55.438374 - Starting sample V13B23-286_A1s1 (82 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 33) of spatial locations
removed 26692 out of 29877 genes due to low expression
2024-12-21 18:19:37.425425 - Starting sample V13B23-286_A1s2 (83 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 32) of spatial locations
removed 27286 out of 29877 genes due to low expression
2024-12-21 18:22:37.817518 - Starting sample V13B23-286_B1s2 (84 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 45) of spatial locations
removed 28776 out of 29877 genes due to low expression
2024-12-21 18:24:04.992018 - Starting sample V13B23-286_B1s1 (85 of 85)
Gene filtering: retaining genes with at least 2 counts in at least 2% (n = 34) of spatial locations
removed 29109 out of 29877 genes due to low expression

# session inf #
```{r}
sessionInfo()
sessioninfo::session_info()
```
> sessionInfo()
R version 4.4.1 RC (2024-06-06 r86719)
Platform: aarch64-apple-darwin20
Running under: macOS Sonoma 14.7.1

Matrix products: default
BLAS:   /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] stats4    stats     graphics  grDevices utils     methods   base     

other attached packages:
 [1] BiocParallel_1.40.0         parallelly_1.40.1          
 [3] colorout_1.3-0.2            scry_1.18.0                
 [5] nnSVG_1.10.0                scran_1.34.0               
 [7] scater_1.34.0               scuttle_1.16.0             
 [9] SpatialExperiment_1.16.0    SingleCellExperiment_1.28.1
[11] SummarizedExperiment_1.36.0 Biobase_2.66.0             
[13] GenomicRanges_1.58.0        GenomeInfoDb_1.42.1        
[15] IRanges_2.40.1              S4Vectors_0.44.0           
[17] BiocGenerics_0.52.0         MatrixGenerics_1.18.0      
[19] matrixStats_1.4.1           gridExtra_2.3              
[21] ggtext_0.1.2                ggplot2_3.5.1              
[23] data.table_1.16.4           rlang_1.1.4                

loaded via a namespace (and not attached):
 [1] pbapply_1.7-2           magrittr_2.0.3          compiler_4.4.1         
 [4] vctrs_0.6.5             rdist_0.0.5             pkgconfig_2.0.3        
 [7] crayon_1.5.3            fastmap_1.2.0           magick_2.8.5           
[10] XVector_0.46.0          utf8_1.2.4              BRISC_1.0.6            
[13] rmarkdown_2.29          sessioninfo_1.2.2       UCSC.utils_1.2.0       
[16] ggbeeswarm_0.7.2        xfun_0.49               bluster_1.16.0         
[19] zlibbioc_1.52.0         beachmat_2.22.0         jsonlite_1.8.9         
[22] DelayedArray_0.32.0     irlba_2.3.5.1           parallel_4.4.1         
[25] cluster_2.1.8           R6_2.5.1                limma_3.62.1           
[28] Rcpp_1.0.13-1           knitr_1.49              Matrix_1.7-1           
[31] igraph_2.1.2            tidyselect_1.2.1        rstudioapi_0.17.1      
[34] abind_1.4-8             yaml_2.3.10             viridis_0.6.5          
[37] codetools_0.2-20        lattice_0.22-6          tibble_3.2.1           
[40] withr_3.0.2             evaluate_1.0.1          xml2_1.3.6             
[43] pillar_1.9.0            generics_0.1.3          rprojroot_2.0.4        
[46] munsell_0.5.1           scales_1.3.0            glue_1.8.0             
[49] metapod_1.14.0          tools_4.4.1             BiocNeighbors_2.0.1    
[52] ScaledMatrix_1.14.0     locfit_1.5-9.10         RANN_2.6.2             
[55] grid_4.4.1              edgeR_4.4.1             colorspace_2.1-1       
[58] GenomeInfoDbData_1.2.13 beeswarm_0.4.0          BiocSingular_1.22.0    
[61] vipor_0.4.7             cli_3.6.3               rsvd_1.0.5             
[64] fansi_1.0.6             S4Arrays_1.6.0          viridisLite_0.4.2      
[67] dplyr_1.1.4             gtable_0.3.6            digest_0.6.37          
[70] SparseArray_1.6.0       ggrepel_0.9.6           dqrng_0.4.1            
[73] rjson_0.2.23            htmltools_0.5.8.1       lifecycle_1.0.4        
[76] httr_1.4.7              here_1.0.1              statmod_1.5.0          
[79] gridtext_0.1.5         
> sessioninfo::session_info()
─ Session info ──────────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.4.1 RC (2024-06-06 r86719)
 os       macOS Sonoma 14.7.1
 system   aarch64, darwin20
 ui       RStudio
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       America/Chicago
 date     2024-12-21
 rstudio  2024.07.0-daily+219 Cranberry Hibiscus (desktop)
 pandoc   3.1.11 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/aarch64/ (via rmarkdown)

─ Packages ──────────────────────────────────────────────────────────────────────
 ! package              * version  date (UTC) lib source
   abind                  1.4-8    2024-09-12 [1] CRAN (R 4.4.1)
   beachmat               2.22.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   beeswarm               0.4.0    2021-06-01 [1] CRAN (R 4.4.0)
   Biobase              * 2.66.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   BiocGenerics         * 0.52.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   BiocNeighbors          2.0.1    2024-11-28 [1] Bioconductor 3.20 (R 4.4.2)
   BiocParallel         * 1.40.0   2024-11-23 [1] Bioconductor 3.20 (R 4.4.2)
   BiocSingular           1.22.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   bluster                1.16.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   BRISC                  1.0.6    2024-10-02 [1] CRAN (R 4.4.1)
 P cli                    3.6.3    2024-06-21 [2] CRAN (R 4.4.0)
   cluster                2.1.8    2024-12-11 [1] CRAN (R 4.4.1)
   codetools              0.2-20   2024-03-31 [1] CRAN (R 4.4.1)
   colorout             * 1.3-0.2  2024-05-01 [1] Github (jalvesaq/colorout@c6113a2)
   colorspace             2.1-1    2024-07-26 [1] CRAN (R 4.4.0)
   crayon                 1.5.3    2024-06-20 [1] CRAN (R 4.4.0)
   data.table           * 1.16.4   2024-12-06 [1] CRAN (R 4.4.1)
   DelayedArray           0.32.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   digest                 0.6.37   2024-08-19 [1] CRAN (R 4.4.1)
   dplyr                  1.1.4    2023-11-17 [1] CRAN (R 4.4.0)
   dqrng                  0.4.1    2024-05-28 [1] CRAN (R 4.4.0)
   edgeR                  4.4.1    2024-12-02 [1] Bioconductor 3.20 (R 4.4.2)
   evaluate               1.0.1    2024-10-10 [1] CRAN (R 4.4.1)
   fansi                  1.0.6    2023-12-08 [1] CRAN (R 4.4.0)
   fastmap                1.2.0    2024-05-15 [1] CRAN (R 4.4.0)
   generics               0.1.3    2022-07-05 [1] CRAN (R 4.4.0)
   GenomeInfoDb         * 1.42.1   2024-11-28 [1] Bioconductor 3.20 (R 4.4.2)
   GenomeInfoDbData       1.2.13   2024-12-12 [1] Bioconductor
   GenomicRanges        * 1.58.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   ggbeeswarm             0.7.2    2023-04-29 [1] CRAN (R 4.4.0)
   ggplot2              * 3.5.1    2024-04-23 [1] CRAN (R 4.4.0)
   ggrepel                0.9.6    2024-09-07 [1] CRAN (R 4.4.1)
   ggtext               * 0.1.2    2022-09-16 [1] CRAN (R 4.4.0)
   glue                   1.8.0    2024-09-30 [1] CRAN (R 4.4.1)
   gridExtra            * 2.3      2017-09-09 [1] CRAN (R 4.4.0)
   gridtext               0.1.5    2022-09-16 [1] CRAN (R 4.4.0)
   gtable                 0.3.6    2024-10-25 [1] CRAN (R 4.4.1)
   here                   1.0.1    2020-12-13 [1] CRAN (R 4.4.0)
   htmltools              0.5.8.1  2024-04-04 [1] CRAN (R 4.4.0)
   httr                   1.4.7    2023-08-15 [1] CRAN (R 4.4.0)
   igraph                 2.1.2    2024-12-07 [1] CRAN (R 4.4.1)
   IRanges              * 2.40.1   2024-12-05 [1] Bioconductor 3.20 (R 4.4.2)
   irlba                  2.3.5.1  2022-10-03 [1] CRAN (R 4.4.0)
   jsonlite               1.8.9    2024-09-20 [1] CRAN (R 4.4.1)
   knitr                  1.49     2024-11-08 [1] CRAN (R 4.4.1)
   lattice                0.22-6   2024-03-20 [1] CRAN (R 4.4.1)
   lifecycle              1.0.4    2023-11-07 [1] CRAN (R 4.4.0)
   limma                  3.62.1   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   locfit                 1.5-9.10 2024-06-24 [1] CRAN (R 4.4.0)
   magick                 2.8.5    2024-09-20 [1] CRAN (R 4.4.1)
   magrittr               2.0.3    2022-03-30 [1] CRAN (R 4.4.0)
   Matrix                 1.7-1    2024-10-18 [1] CRAN (R 4.4.1)
   MatrixGenerics       * 1.18.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   matrixStats          * 1.4.1    2024-09-08 [1] CRAN (R 4.4.1)
   metapod                1.14.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   munsell                0.5.1    2024-04-01 [1] CRAN (R 4.4.0)
   nnSVG                * 1.10.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   parallelly           * 1.40.1   2024-12-04 [1] CRAN (R 4.4.1)
   pbapply                1.7-2    2023-06-27 [1] CRAN (R 4.4.0)
   pillar                 1.9.0    2023-03-22 [1] CRAN (R 4.4.0)
   pkgconfig              2.0.3    2019-09-22 [1] CRAN (R 4.4.0)
   R6                     2.5.1    2021-08-19 [1] CRAN (R 4.4.0)
   RANN                   2.6.2    2024-08-25 [1] CRAN (R 4.4.1)
   Rcpp                   1.0.13-1 2024-11-02 [1] CRAN (R 4.4.1)
   rdist                  0.0.5    2020-05-04 [1] CRAN (R 4.4.0)
   rjson                  0.2.23   2024-09-16 [1] CRAN (R 4.4.1)
 P rlang                * 1.1.4    2024-06-04 [2] CRAN (R 4.4.1)
   rmarkdown              2.29     2024-11-04 [1] CRAN (R 4.4.1)
   rprojroot              2.0.4    2023-11-05 [1] CRAN (R 4.4.0)
   rstudioapi             0.17.1   2024-10-22 [1] CRAN (R 4.4.1)
   rsvd                   1.0.5    2021-04-16 [1] CRAN (R 4.4.0)
   S4Arrays               1.6.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   S4Vectors            * 0.44.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   ScaledMatrix           1.14.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   scales                 1.3.0    2023-11-28 [1] CRAN (R 4.4.0)
   scater               * 1.34.0   2024-10-29 [1] Bioconductor 3.20 (R 4.4.1)
   scran                * 1.34.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   scry                 * 1.18.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   scuttle              * 1.16.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   sessioninfo            1.2.2    2021-12-06 [1] CRAN (R 4.4.0)
   SingleCellExperiment * 1.28.1   2024-11-23 [1] Bioconductor 3.20 (R 4.4.2)
   SparseArray            1.6.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   SpatialExperiment    * 1.16.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   statmod                1.5.0    2023-01-06 [1] CRAN (R 4.4.0)
   SummarizedExperiment * 1.36.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   tibble                 3.2.1    2023-03-20 [1] CRAN (R 4.4.0)
   tidyselect             1.2.1    2024-03-11 [1] CRAN (R 4.4.0)
   UCSC.utils             1.2.0    2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   utf8                   1.2.4    2023-10-22 [1] CRAN (R 4.4.0)
   vctrs                  0.6.5    2023-12-01 [1] CRAN (R 4.4.0)
   vipor                  0.4.7    2023-12-18 [1] CRAN (R 4.4.0)
   viridis                0.6.5    2024-01-29 [1] CRAN (R 4.4.0)
   viridisLite            0.4.2    2023-05-02 [1] CRAN (R 4.4.0)
   withr                  3.0.2    2024-10-28 [1] CRAN (R 4.4.1)
   xfun                   0.49     2024-10-31 [1] CRAN (R 4.4.1)
   xml2                   1.3.6    2023-12-04 [1] CRAN (R 4.4.0)
   XVector                0.46.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)
   yaml                   2.3.10   2024-07-26 [1] CRAN (R 4.4.0)
   zlibbioc               1.52.0   2024-11-08 [1] Bioconductor 3.20 (R 4.4.1)

 [1] /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library
 [2] /Users/bmulvey/Library/R/arm64/4.4/library

 P ── Loaded and on-disk path mismatch.

─────────────────────────────────────────────────────────────────────────────────
